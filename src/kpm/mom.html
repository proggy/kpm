<!-- Generated by Cython 0.15.1 on Wed Feb 12 11:16:09 2014 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display == 'none') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.15.1 on Wed Feb 12 11:16:09 2014
<p>Raw output: <a href="mom.c">mom.c</a>
<pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line1")'> 1: #!/usr/bin/env python</pre>
<pre id='line1' class='code' style='background-color: #FFFF79'>
  /* "kpm/mom.pyx":1
 * #!/usr/bin/env python             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * # -*- coding: utf-8 -*-
 * """Calculate Chebychev moments.
 */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_1));
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____test__, ((PyObject *)__pyx_t_1)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_1)); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: # -*- coding: utf-8 -*-</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: """Calculate Chebychev moments.</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: </pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: (At least) three kinds of moments can be distinguished:</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: - expectation values of the form &lt;a|T_n(H)|b&gt;</pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: - expectation values with a==b, &lt;a|T_n(H)|a&gt; (able to yield 2 moments per loop)</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: - traces Tr[A*T_n(H)] (do averaging in high-level module using the above?)</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9: </pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10: Right now, only the second kind &lt;a|T_n(H)|a&gt; is implemented, which is needed</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11: to calculate the local density of states (LDOS)."""</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line12")'> 12: __created__ = '2012-08-06'</pre>
<pre id='line12' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":12
 * Right now, only the second kind <code><</code>a|T_n(H)|a> is implemented, which is needed
 * to calculate the local density of states (LDOS)."""
 * __created__ = '2012-08-06'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * __modified__ = '2012-09-05'
 * import cython
 */
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____created__, ((PyObject *)__pyx_kp_s_41)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line13")'> 13: __modified__ = '2012-09-05'</pre>
<pre id='line13' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":13
 * to calculate the local density of states (LDOS)."""
 * __created__ = '2012-08-06'
 * __modified__ = '2012-09-05'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * import cython
 * import numpy
 */
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s____modified__, ((PyObject *)__pyx_kp_s_17)) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14: import cython</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line15")'> 15: import numpy</pre>
<pre id='line15' class='code' style='background-color: #FFFF8d'>
  /* "kpm/mom.pyx":15
 * __modified__ = '2012-09-05'
 * import cython
 * import numpy             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * import scipy.sparse
 * cimport libc.math
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__numpy), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__numpy, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 15; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line16")'> 16: import scipy.sparse</pre>
<pre id='line16' class='code' style='background-color: #FFFF8d'>
  /* "kpm/mom.pyx":16
 * import cython
 * import numpy
 * import scipy.sparse             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * cimport libc.math
 * cimport libc.stdlib
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s_42), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__scipy, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 16; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17: cimport libc.math</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: cimport libc.stdlib</pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: cimport numpy</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line20")'> 20: from cython.parallel import *</pre>
<pre id='line20' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21: cimport openmp</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line22")'> 22: import misc</pre>
<pre id='line22' class='code' style='background-color: #FFFF8d'>
  /* "kpm/mom.pyx":22
 * from cython.parallel import *
 * cimport openmp
 * import misc             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(((PyObject *)__pyx_n_s__misc), 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__misc, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 22; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: </pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24: </pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25: # to do</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26: #def trace(...)</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27: #def expec2(...)</pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28: #def _expec_csr_real(indices, indptr, data, rank, state, limit, out=None)</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29: #def _expec2_csr_real(indices, indptr, data, state1, state2, limit, ...)</pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30: #def _trace_csr_real(indices, indptr, data, randstates, limit, ...)</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31: # etc.</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32: </pre>
<pre id='line32' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line33")'> 33: </pre>
<pre id='line33' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line34")'> 34: def expec(mat, state, limit, omp=False, num_threads=None, out=None):</pre>
<pre id='line34' class='code' style='background-color: #FFFF1c'>
/* "kpm/mom.pyx":34
 * 
 * 
 * def expec(mat, state, limit, omp=False, num_threads=None, out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """expec(mat, state, limit, omp=False, num_threads=None, out=None)
 * 
 */

static PyObject *__pyx_pf_3kpm_3mom_expec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3kpm_3mom_expec[] = "expec(mat, state, limit, omp=False, num_threads=None, out=None)\n\n    Calculate Chebychev moments for expectation values of the form <code><</code>a|T_n(H)|a>\n    for a certain state vector |a> \"state\" and a Hamiltonian matrix H \"mat\".\n    Specify required number of moments \"limit\" (truncation limit). If \"out\" is\n    not None, store the results in \"out\" instead of returning them.\n\n    It is recommended to provide the matrix in the CSR sparse matrix format,\n    since this is the best and fastest format for the matrix-vector\n    multiplication which is the very heart of every KPM algorithm.\n\n    This function only delegates the work to the corresponding low-level\n    functions, all beginning with \"_expec_\". If no optimal low-level function\n    is found for the given datatype, the plain Python implementation \"_expec\"\n    is used (TO DO).\n\n    If \"omp\" is True, use available OpenMP-parallelized variants of the\n    algorithms. If \"num_threads\" is not None, set the number of threads\n    accordingly. If \"num_threads\" is smaller than 1, determine the number of\n    processor cores automatically.";
static PyMethodDef __pyx_mdef_3kpm_3mom_expec = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("expec"), (PyCFunction)__pyx_pf_3kpm_3mom_expec, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3kpm_3mom_expec)};
static PyObject *__pyx_pf_3kpm_3mom_expec(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mat = 0;
  PyObject *__pyx_v_state = 0;
  PyObject *__pyx_v_limit = 0;
  PyObject *__pyx_v_omp = 0;
  PyObject *__pyx_v_num_threads = 0;
  PyObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_v___modified__ = NULL;
  PyObject *__pyx_v_func = NULL;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__mat,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__omp,&__pyx_n_s__num_threads,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("expec");
  __pyx_self = __pyx_self;
  {
    PyObject* values[6] = {0,0,0,0,0,0};
    values[3] = __pyx_k_1;
    values[4] = ((PyObject *)Py_None);
    values[5] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__mat);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("expec", 0, 3, 6, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("expec", 0, 3, 6, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__omp);
          if (value) { values[3] = value; kw_args--; }
        }
        case  4:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__num_threads);
          if (value) { values[4] = value; kw_args--; }
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "expec") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_mat = values[0];
    __pyx_v_state = values[1];
    __pyx_v_limit = values[2];
    __pyx_v_omp = values[3];
    __pyx_v_num_threads = values[4];
    __pyx_v_out = values[5];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("expec", 0, 3, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom.expec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mat);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limit);

  /* "kpm/mom.pyx":34
 * 
 * 
 * def expec(mat, state, limit, omp=False, num_threads=None, out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """expec(mat, state, limit, omp=False, num_threads=None, out=None)
 * 
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  __pyx_k_1 = __pyx_t_1;
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_expec, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s__expec, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35:     """expec(mat, state, limit, omp=False, num_threads=None, out=None)</pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line36")'> 36: </pre>
<pre id='line36' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:     Calculate Chebychev moments for expectation values of the form &lt;a|T_n(H)|a&gt;</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:     for a certain state vector |a&gt; "state" and a Hamiltonian matrix H "mat".</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39:     Specify required number of moments "limit" (truncation limit). If "out" is</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40:     not None, store the results in "out" instead of returning them.</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41: </pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:     It is recommended to provide the matrix in the CSR sparse matrix format,</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43:     since this is the best and fastest format for the matrix-vector</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:     multiplication which is the very heart of every KPM algorithm.</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45: </pre>
<pre id='line45' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:     This function only delegates the work to the corresponding low-level</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:     functions, all beginning with "_expec_". If no optimal low-level function</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line48")'> 48:     is found for the given datatype, the plain Python implementation "_expec"</pre>
<pre id='line48' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49:     is used (TO DO).</pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50: </pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51:     If "omp" is True, use available OpenMP-parallelized variants of the</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:     algorithms. If "num_threads" is not None, set the number of threads</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:     accordingly. If "num_threads" is smaller than 1, determine the number of</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:     processor cores automatically."""</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line55")'> 55:     __created__ = '2012-08-17'</pre>
<pre id='line55' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":55
 *     accordingly. If "num_threads" is smaller than 1, determine the number of
 *     processor cores automatically."""
 *     __created__ = '2012-08-17'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __modified__ = '2012-08-19'
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_2));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_2);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line56")'> 56:     __modified__ = '2012-08-19'</pre>
<pre id='line56' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":56
 *     processor cores automatically."""
 *     __created__ = '2012-08-17'
 *     __modified__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # prepare
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___modified__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57: </pre>
<pre id='line57' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58:     # prepare</pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line59")'> 59:     if omp:</pre>
<pre id='line59' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":59
 * 
 *     # prepare
 *     if omp:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         misc.set_num_threads(num_threads)
 *     limit = int(limit)
 */
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_omp);<span class='error_goto'> if (unlikely(__pyx_t_1 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 59; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line60")'> 60:         misc.set_num_threads(num_threads)</pre>
<pre id='line60' class='code' style='background-color: #FFFF4d'>
    /* "kpm/mom.pyx":60
 *     # prepare
 *     if omp:
 *         misc.set_num_threads(num_threads)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     limit = int(limit)
 *     if limit <code><</code> 1:
 */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__misc);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__set_num_threads);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_num_threads);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_num_threads);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_num_threads);
    __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 60; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line61")'> 61:     limit = int(limit)</pre>
<pre id='line61' class='code' style='background-color: #FFFF6a'>
  /* "kpm/mom.pyx":61
 *     if omp:
 *         misc.set_num_threads(num_threads)
 *     limit = int(limit)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limit);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_limit);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_limit);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyInt_Type))), ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_limit);
  __pyx_v_limit = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class='line' style='background-color: #FFFF79' onclick='toggleDiv("line62")'> 62:     if limit &lt; 1:</pre>
<pre id='line62' class='code' style='background-color: #FFFF79'>
  /* "kpm/mom.pyx":62
 *         misc.set_num_threads(num_threads)
 *     limit = int(limit)
 *     if limit <code><</code> 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     #if not isinstance(mat, scipy.sparse.csr_matrix): #base.spmatrix
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_limit, __pyx_int_1, Py_LT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_1 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 62; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line63")'> 63:         raise ValueError('bad truncation limit, expecting positive integer')</pre>
<pre id='line63' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":63
 *     limit = int(limit)
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #if not isinstance(mat, scipy.sparse.csr_matrix): #base.spmatrix
 *         #raise TypeError, 'bad matrix format, expecting CSR sparse matrix'
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_5), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "kpm/mom.pyx":63
 *     limit = int(limit)
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     #if not isinstance(mat, scipy.sparse.csr_matrix): #base.spmatrix
 *         #raise TypeError, 'bad matrix format, expecting CSR sparse matrix'
 */
  __pyx_k_tuple_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 63; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_5));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_5, 0, ((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_5));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64:     #if not isinstance(mat, scipy.sparse.csr_matrix): #base.spmatrix</pre>
<pre id='line64' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65:         #raise TypeError, 'bad matrix format, expecting CSR sparse matrix'</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line66")'> 66:     if mat.shape[0] != mat.shape[1]:</pre>
<pre id='line66' class='code' style='background-color: #FFFF41'>
  /* "kpm/mom.pyx":66
 *     #if not isinstance(mat, scipy.sparse.csr_matrix): #base.spmatrix
 *         #raise TypeError, 'bad matrix format, expecting CSR sparse matrix'
 *     if mat.shape[0] != mat.shape[1]:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad matrix shape, expecting square matrix')
 *     state = numpy.array(state)
 */
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 0, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 1, sizeof(long), PyInt_FromLong);<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_t_3, Py_NE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_1 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 66; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line67")'> 67:         raise ValueError('bad matrix shape, expecting square matrix')</pre>
<pre id='line67' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":67
 *         #raise TypeError, 'bad matrix format, expecting CSR sparse matrix'
 *     if mat.shape[0] != mat.shape[1]:
 *         raise ValueError('bad matrix shape, expecting square matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     state = numpy.array(state)
 *     if state.ndim != 1:
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_7), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L8;
  }
  __pyx_L8:;

  /* "kpm/mom.pyx":67
 *         #raise TypeError, 'bad matrix format, expecting CSR sparse matrix'
 *     if mat.shape[0] != mat.shape[1]:
 *         raise ValueError('bad matrix shape, expecting square matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     state = numpy.array(state)
 *     if state.ndim != 1:
 */
  __pyx_k_tuple_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_7));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_6));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_7, 0, ((PyObject *)__pyx_kp_s_6));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_6));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_7));
</pre><pre class='line' style='background-color: #FFFF4d' onclick='toggleDiv("line68")'> 68:     state = numpy.array(state)</pre>
<pre id='line68' class='code' style='background-color: #FFFF4d'>
  /* "kpm/mom.pyx":68
 *     if mat.shape[0] != mat.shape[1]:
 *         raise ValueError('bad matrix shape, expecting square matrix')
 *     state = numpy.array(state)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if state.ndim != 1:
 *         raise ValueError('bad state, expecting 1D array')
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_state);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_state);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_state);
  __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_state);
  __pyx_v_state = __pyx_t_4;
  __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line69")'> 69:     if state.ndim != 1:</pre>
<pre id='line69' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":69
 *         raise ValueError('bad matrix shape, expecting square matrix')
 *     state = numpy.array(state)
 *     if state.ndim != 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad state, expecting 1D array')
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_state, __pyx_n_s__ndim);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_4, __pyx_int_1, Py_NE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_1 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(__pyx_t_1 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line70")'> 70:         raise ValueError('bad state, expecting 1D array')</pre>
<pre id='line70' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":70
 *     state = numpy.array(state)
 *     if state.ndim != 1:
 *         raise ValueError('bad state, expecting 1D array')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # choose appropriate low-level function
 */
    __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_9), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L9;
  }
  __pyx_L9:;

  /* "kpm/mom.pyx":70
 *     state = numpy.array(state)
 *     if state.ndim != 1:
 *         raise ValueError('bad state, expecting 1D array')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # choose appropriate low-level function
 */
  __pyx_k_tuple_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_9));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_8));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_9, 0, ((PyObject *)__pyx_kp_s_8));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_8));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_9));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71: </pre>
<pre id='line71' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line72")'> 72:     # choose appropriate low-level function</pre>
<pre id='line72' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line73")'> 73:     if isinstance(mat, scipy.sparse.base.spmatrix):</pre>
<pre id='line73' class='code' style='background-color: #FFFF46'>
  /* "kpm/mom.pyx":73
 * 
 *     # choose appropriate low-level function
 *     if isinstance(mat, scipy.sparse.base.spmatrix):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # sparse matrix given
 *         if isinstance(mat, scipy.sparse.csr_matrix):
 */
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__scipy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__sparse);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_4, __pyx_n_s__base);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__spmatrix);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_mat, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74:         # sparse matrix given</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line75")'> 75:         if isinstance(mat, scipy.sparse.csr_matrix):</pre>
<pre id='line75' class='code' style='background-color: #FFFF55'>
    /* "kpm/mom.pyx":75
 *     if isinstance(mat, scipy.sparse.base.spmatrix):
 *         # sparse matrix given
 *         if isinstance(mat, scipy.sparse.csr_matrix):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # CSR sparse matrix given
 *             if mat.dtype is numpy.dtype(float) \
 */
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__scipy);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_4, __pyx_n_s__sparse);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__csr_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_mat, __pyx_t_4);<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:             # CSR sparse matrix given</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line77")'> 77:             if mat.dtype is numpy.dtype(float) \</pre>
<pre id='line77' class='code' style='background-color: #FFFF55'>
      /* "kpm/mom.pyx":77
 *         if isinstance(mat, scipy.sparse.csr_matrix):
 *             # CSR sparse matrix given
 *             if mat.dtype is numpy.dtype(float) \             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     and state.dtype is numpy.dtype(float):
 *                 state = state.astype(float)
 */
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__dtype);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyFloat_Type))));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)((PyObject*)(&PyFloat_Type))));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyFloat_Type))));
      __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 77; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
      __pyx_t_1 = (__pyx_t_4 == __pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line78")'> 78:                     and state.dtype is numpy.dtype(float):</pre>
<pre id='line78' class='code' style='background-color: #FFFF55'>
        /* "kpm/mom.pyx":78
 *             # CSR sparse matrix given
 *             if mat.dtype is numpy.dtype(float) \
 *                     and state.dtype is numpy.dtype(float):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 state = state.astype(float)
 *                 func = _expec_csr_real_omp if omp else _expec_csr_real
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_state, __pyx_n_s__dtype);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyFloat_Type))));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)((PyObject*)(&PyFloat_Type))));
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyFloat_Type))));
        __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 78; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __pyx_t_5 = (__pyx_t_3 == __pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_6 = __pyx_t_5;
      } else {
        __pyx_t_6 = __pyx_t_1;
      }
      if (__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line79")'> 79:                 state = state.astype(float)</pre>
<pre id='line79' class='code' style='background-color: #FFFF55'>
        /* "kpm/mom.pyx":79
 *             if mat.dtype is numpy.dtype(float) \
 *                     and state.dtype is numpy.dtype(float):
 *                 state = state.astype(float)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 func = _expec_csr_real_omp if omp else _expec_csr_real
 *             elif mat.dtype is numpy.dtype(complex) \
 */
        __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_state, __pyx_n_s__astype);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyFloat_Type))));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)((PyObject*)(&PyFloat_Type))));
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyFloat_Type))));
        __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_2, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_state);
        __pyx_v_state = __pyx_t_4;
        __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line80")'> 80:                 func = _expec_csr_real_omp if omp else _expec_csr_real</pre>
<pre id='line80' class='code' style='background-color: #FFFF86'>
        /* "kpm/mom.pyx":80
 *                     and state.dtype is numpy.dtype(float):
 *                 state = state.astype(float)
 *                 func = _expec_csr_real_omp if omp else _expec_csr_real             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             elif mat.dtype is numpy.dtype(complex) \
 *                     or state.dtype is numpy.dtype(complex):
 */
        __pyx_t_6 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_omp);<span class='error_goto'> if (unlikely(__pyx_t_6 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        if (__pyx_t_6) {
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s___expec_csr_real_omp);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
          __pyx_t_4 = __pyx_t_3;
          __pyx_t_3 = 0;
        } else {
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s___expec_csr_real);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
          __pyx_t_4 = __pyx_t_3;
          __pyx_t_3 = 0;
        }
        __pyx_v_func = __pyx_t_4;
        __pyx_t_4 = 0;
        goto __pyx_L12;
      }
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line81")'> 81:             elif mat.dtype is numpy.dtype(complex) \</pre>
<pre id='line81' class='code' style='background-color: #FFFF55'>
      /* "kpm/mom.pyx":81
 *                 state = state.astype(float)
 *                 func = _expec_csr_real_omp if omp else _expec_csr_real
 *             elif mat.dtype is numpy.dtype(complex) \             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     or state.dtype is numpy.dtype(complex):
 *                 state = state.astype(complex)
 */
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__dtype);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)((PyObject*)(&PyComplex_Type))));
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
      __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_6 = (__pyx_t_4 == __pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      if (!__pyx_t_6) {
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line82")'> 82:                     or state.dtype is numpy.dtype(complex):</pre>
<pre id='line82' class='code' style='background-color: #FFFF55'>
        /* "kpm/mom.pyx":82
 *                 func = _expec_csr_real_omp if omp else _expec_csr_real
 *             elif mat.dtype is numpy.dtype(complex) \
 *                     or state.dtype is numpy.dtype(complex):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 state = state.astype(complex)
 *                 mat = mat.astype(complex)  # write additional variants
 */
        __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_state, __pyx_n_s__dtype);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, ((PyObject *)((PyObject*)(&PyComplex_Type))));
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
        __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)__pyx_ptype_5numpy_dtype)), ((PyObject *)__pyx_t_4), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 82; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
        __pyx_t_1 = (__pyx_t_2 == __pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_5 = __pyx_t_1;
      } else {
        __pyx_t_5 = __pyx_t_6;
      }
      if (__pyx_t_5) {
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line83")'> 83:                 state = state.astype(complex)</pre>
<pre id='line83' class='code' style='background-color: #FFFF55'>
        /* "kpm/mom.pyx":83
 *             elif mat.dtype is numpy.dtype(complex) \
 *                     or state.dtype is numpy.dtype(complex):
 *                 state = state.astype(complex)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 mat = mat.astype(complex)  # write additional variants
 *                 func = _expec_csr_complex_omp if omp else _expec_csr_complex
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_state, __pyx_n_s__astype);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)((PyObject*)(&PyComplex_Type))));
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
        __pyx_t_4 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_3, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 83; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_state);
        __pyx_v_state = __pyx_t_4;
        __pyx_t_4 = 0;
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line84")'> 84:                 mat = mat.astype(complex)  # write additional variants</pre>
<pre id='line84' class='code' style='background-color: #FFFF55'>
        /* "kpm/mom.pyx":84
 *                     or state.dtype is numpy.dtype(complex):
 *                 state = state.astype(complex)
 *                 mat = mat.astype(complex)  # write additional variants             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 func = _expec_csr_complex_omp if omp else _expec_csr_complex
 *             else:
 */
        __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__astype);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
        __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)((PyObject*)(&PyComplex_Type))));
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)((PyObject*)(&PyComplex_Type))));
        __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_4, ((PyObject *)__pyx_t_2), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 84; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_mat);
        __pyx_v_mat = __pyx_t_3;
        __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line85")'> 85:                 func = _expec_csr_complex_omp if omp else _expec_csr_complex</pre>
<pre id='line85' class='code' style='background-color: #FFFF86'>
        /* "kpm/mom.pyx":85
 *                 state = state.astype(complex)
 *                 mat = mat.astype(complex)  # write additional variants
 *                 func = _expec_csr_complex_omp if omp else _expec_csr_complex             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             else:
 *                 raise ValueError('datatype not supported: %s' % mat.dtype)
 */
        __pyx_t_5 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_omp);<span class='error_goto'> if (unlikely(__pyx_t_5 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        if (__pyx_t_5) {
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
          __pyx_t_3 = __pyx_t_2;
          __pyx_t_2 = 0;
        } else {
          __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s___expec_csr_complex);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
          <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
          __pyx_t_3 = __pyx_t_2;
          __pyx_t_2 = 0;
        }
        __pyx_v_func = __pyx_t_3;
        __pyx_t_3 = 0;
        goto __pyx_L12;
      }
      /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:             else:</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF46' onclick='toggleDiv("line87")'> 87:                 raise ValueError('datatype not supported: %s' % mat.dtype)</pre>
<pre id='line87' class='code' style='background-color: #FFFF46'>
        /* "kpm/mom.pyx":87
 *                 func = _expec_csr_complex_omp if omp else _expec_csr_complex
 *             else:
 *                 raise ValueError('datatype not supported: %s' % mat.dtype)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             return func(mat.indices, mat.indptr, mat.data, state, limit,
 *                         out=out)
 */
        __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__dtype);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
        __pyx_t_2 = <span class='py_c_api'>PyNumber_Remainder</span>(((PyObject *)__pyx_kp_s_11), __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_t_2));
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_t_2));
        __pyx_t_2 = 0;
        __pyx_t_2 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
        <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
        <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
       <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      }
      __pyx_L12:;
</pre><pre class='line' style='background-color: #FFFF3b' onclick='toggleDiv("line88")'> 88:             return func(mat.indices, mat.indptr, mat.data, state, limit,</pre>
<pre id='line88' class='code' style='background-color: #FFFF3b'>
      /* "kpm/mom.pyx":88
 *             else:
 *                 raise ValueError('datatype not supported: %s' % mat.dtype)
 *             return func(mat.indices, mat.indptr, mat.data, state, limit,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         out=out)
 *         else:
 */
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_2 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__indices);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__indptr);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_v_mat, __pyx_n_s__data);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
      __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(5);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_7));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_2);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_3);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 2, __pyx_t_4);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_state);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 3, __pyx_v_state);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_state);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limit);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 4, __pyx_v_limit);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_limit);
      __pyx_t_2 = 0;
      __pyx_t_3 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
</pre><pre class='line' style='background-color: #FFFF73' onclick='toggleDiv("line89")'> 89:                         out=out)</pre>
<pre id='line89' class='code' style='background-color: #FFFF73'>
      /* "kpm/mom.pyx":89
 *                 raise ValueError('datatype not supported: %s' % mat.dtype)
 *             return func(mat.indices, mat.indptr, mat.data, state, limit,
 *                         out=out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         else:
 *             # use plain Python algorithm for other sparse matrix formats
 */
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__out), __pyx_v_out) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_3 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_v_func, ((PyObject *)__pyx_t_7), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      __pyx_r = __pyx_t_3;
      __pyx_t_3 = 0;
      goto __pyx_L0;
      goto __pyx_L11;
    }
    /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90:         else:</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91:             # use plain Python algorithm for other sparse matrix formats</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line92")'> 92:             return _expec_sparse(mat, state, limit, out=out)</pre>
<pre id='line92' class='code' style='background-color: #FFFF3c'>
      /* "kpm/mom.pyx":92
 *         else:
 *             # use plain Python algorithm for other sparse matrix formats
 *             return _expec_sparse(mat, state, limit, out=out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     elif isinstance(mat, numpy.ndarray) or isinstance(mat, numpy.matrix):
 *         # dense matrix given
 */
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s___expec_sparse);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mat);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_v_mat);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_mat);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_state);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_v_state);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_state);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limit);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 2, __pyx_v_limit);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_limit);
      __pyx_t_7 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_7));
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, ((PyObject *)__pyx_n_s__out), __pyx_v_out) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      __pyx_t_2 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_3, ((PyObject *)__pyx_t_4), ((PyObject *)__pyx_t_7));<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_7)); __pyx_t_7 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;
    }
    __pyx_L11:;
    goto __pyx_L10;
  }
</pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line93")'> 93:     elif isinstance(mat, numpy.ndarray) or isinstance(mat, numpy.matrix):</pre>
<pre id='line93' class='code' style='background-color: #FFFF5b'>
  /* "kpm/mom.pyx":93
 *             # use plain Python algorithm for other sparse matrix formats
 *             return _expec_sparse(mat, state, limit, out=out)
 *     elif isinstance(mat, numpy.ndarray) or isinstance(mat, numpy.matrix):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # dense matrix given
 *         return _expec_dense(mat, state, limit, out=out)
 */
  __pyx_t_2 = ((PyObject *)((PyObject*)__pyx_ptype_5numpy_ndarray));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_TypeCheck</span>(__pyx_v_mat, __pyx_t_2); 
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!__pyx_t_5) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_2);
    __pyx_t_7 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_2, __pyx_n_s__matrix);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyObject_IsInstance</span>(__pyx_v_mat, __pyx_t_7);<span class='error_goto'> if (unlikely(__pyx_t_6 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_1 = __pyx_t_6;
  } else {
    __pyx_t_1 = __pyx_t_5;
  }
  if (__pyx_t_1) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:         # dense matrix given</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF3c' onclick='toggleDiv("line95")'> 95:         return _expec_dense(mat, state, limit, out=out)</pre>
<pre id='line95' class='code' style='background-color: #FFFF3c'>
    /* "kpm/mom.pyx":95
 *     elif isinstance(mat, numpy.ndarray) or isinstance(mat, numpy.matrix):
 *         # dense matrix given
 *         return _expec_dense(mat, state, limit, out=out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     else:
 *         raise ValueError('unknown matrix format')
 */
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s___expec_dense);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_7);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_2));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_mat);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_mat);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_mat);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_state);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_v_state);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_state);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_limit);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 2, __pyx_v_limit);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_v_limit);
    __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, ((PyObject *)__pyx_n_s__out), __pyx_v_out) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_3 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_7, ((PyObject *)__pyx_t_2), ((PyObject *)__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_2)); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;
    goto __pyx_L10;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:     else:</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF41' onclick='toggleDiv("line97")'> 97:         raise ValueError('unknown matrix format')</pre>
<pre id='line97' class='code' style='background-color: #FFFF41'>
    /* "kpm/mom.pyx":97
 *         return _expec_dense(mat, state, limit, out=out)
 *     else:
 *         raise ValueError('unknown matrix format')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_13), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_L10:;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom.expec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___modified__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_func);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_mat);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_limit);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "kpm/mom.pyx":97
 *         return _expec_dense(mat, state, limit, out=out)
 *     else:
 *         raise ValueError('unknown matrix format')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_k_tuple_13 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_13));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_12));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_13, 0, ((PyObject *)__pyx_kp_s_12));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_12));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_13));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98: </pre>
<pre id='line98' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99: </pre>
<pre id='line99' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100: #=====================#</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: # Low-level functions #</pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: #=====================#</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line103")'> 103: </pre>
<pre id='line103' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104: </pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line105")'> 105: def _expec_dense(object mat, object state, int limit, out=None):</pre>
<pre id='line105' class='code' style='background-color: #FFFF21'>
/* "kpm/mom.pyx":105
 * 
 * 
 * def _expec_dense(object mat, object state, int limit, out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')
 */

static PyObject *__pyx_pf_3kpm_3mom_1_expec_dense(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3kpm_3mom_1_expec_dense = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("_expec_dense"), (PyCFunction)__pyx_pf_3kpm_3mom_1_expec_dense, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pf_3kpm_3mom_1_expec_dense(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mat = 0;
  PyObject *__pyx_v_state = 0;
  int __pyx_v_limit;
  PyObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__mat,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_expec_dense");
  __pyx_self = __pyx_self;
  {
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__mat);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_dense", 0, 3, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_dense", 0, 3, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "_expec_dense") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_mat = values[0];
    __pyx_v_state = values[1];
    __pyx_v_limit = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_limit == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_out = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_dense", 0, 3, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_dense", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "kpm/mom.pyx":105
 * 
 * 
 * def _expec_dense(object mat, object state, int limit, out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_1_expec_dense, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s___expec_dense, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line106")'> 106:     __created__ = '2012-08-19'</pre>
<pre id='line106' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":106
 * 
 * def _expec_dense(object mat, object state, int limit, out=None):
 *     __created__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     raise NotImplementedError('please use CSR sparse matrix')
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line107")'> 107:     raise NotImplementedError('please use CSR sparse matrix')</pre>
<pre id='line107' class='code' style='background-color: #FFFF52'>
  /* "kpm/mom.pyx":107
 * def _expec_dense(object mat, object state, int limit, out=None):
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_NotImplementedError, ((PyObject *)__pyx_k_tuple_15), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
 <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_dense", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "kpm/mom.pyx":107
 * def _expec_dense(object mat, object state, int limit, out=None):
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_k_tuple_15 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_15));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_14));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_15, 0, ((PyObject *)__pyx_kp_s_14));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_14));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_15));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108: </pre>
<pre id='line108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109: </pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF21' onclick='toggleDiv("line110")'> 110: def _expec_sparse(object mat, object state, int limit, out=None):</pre>
<pre id='line110' class='code' style='background-color: #FFFF21'>
/* "kpm/mom.pyx":110
 * 
 * 
 * def _expec_sparse(object mat, object state, int limit, out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')
 */

static PyObject *__pyx_pf_3kpm_3mom_2_expec_sparse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3kpm_3mom_2_expec_sparse = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("_expec_sparse"), (PyCFunction)__pyx_pf_3kpm_3mom_2_expec_sparse, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pf_3kpm_3mom_2_expec_sparse(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_mat = 0;
  PyObject *__pyx_v_state = 0;
  int __pyx_v_limit;
  PyObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__mat,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_expec_sparse");
  __pyx_self = __pyx_self;
  {
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__mat);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_sparse", 0, 3, 4, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_sparse", 0, 3, 4, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "_expec_sparse") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_mat = values[0];
    __pyx_v_state = values[1];
    __pyx_v_limit = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_limit == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_out = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_sparse", 0, 3, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_sparse", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;

  /* "kpm/mom.pyx":110
 * 
 * 
 * def _expec_sparse(object mat, object state, int limit, out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_2_expec_sparse, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s___expec_sparse, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line111")'> 111:     __created__ = '2012-08-19'</pre>
<pre id='line111' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":111
 * 
 * def _expec_sparse(object mat, object state, int limit, out=None):
 *     __created__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     raise NotImplementedError('please use CSR sparse matrix')
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFF52' onclick='toggleDiv("line112")'> 112:     raise NotImplementedError('please use CSR sparse matrix')</pre>
<pre id='line112' class='code' style='background-color: #FFFF52'>
  /* "kpm/mom.pyx":112
 * def _expec_sparse(object mat, object state, int limit, out=None):
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_NotImplementedError, ((PyObject *)__pyx_k_tuple_16), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
 <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_sparse", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}

  /* "kpm/mom.pyx":112
 * def _expec_sparse(object mat, object state, int limit, out=None):
 *     __created__ = '2012-08-19'
 *     raise NotImplementedError('please use CSR sparse matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_k_tuple_16 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_16)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 112; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_16));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_14));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_16, 0, ((PyObject *)__pyx_kp_s_14));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_14));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_16));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113: </pre>
<pre id='line113' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114: </pre>
<pre id='line114' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line115")'> 115: @cython.cdivision(True)</pre>
<pre id='line115' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116: @cython.boundscheck(False)</pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line117")'> 117: def _expec_csr_real(numpy.ndarray[int, mode="c"] indices,</pre>
<pre id='line117' class='code' style='background-color: #FFFF8d'>
/* "kpm/mom.pyx":117
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_real(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     numpy.ndarray[int, mode="c"] indptr,
 *                     numpy.ndarray[double, mode="c"] data,
 */

static PyObject *__pyx_pf_3kpm_3mom_3_expec_csr_real(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3kpm_3mom_3_expec_csr_real[] = "_expec_csr_real(numpy.ndarray[int, mode=\"c\"]    indices,\n                    numpy.ndarray[int, mode=\"c\"]    indptr,\n                    numpy.ndarray[double, mode=\"c\"] data,\n                    numpy.ndarray[double, mode=\"c\"] state,\n                    int                             limit,\n                    numpy.ndarray[double, mode=\"c\"] out=None)\n\n    Calculate real Chebychev moments for expectation values of the form\n    <code><</code>a|T_n(H)|a> for a real state vector |a> \"state\" and a real CSR matrix H,\n    defined by column indices \"indices\", row pointer \"indptr\" and non-zero\n    values \"data\". Specify required number of moments \"limit\" (truncation\n    limit). If \"out\" is not None, store the results in \"out\" instead of\n    returning them.\n\n    ";
static PyMethodDef __pyx_mdef_3kpm_3mom_3_expec_csr_real = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("_expec_csr_real"), (PyCFunction)__pyx_pf_3kpm_3mom_3_expec_csr_real, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3kpm_3mom_3_expec_csr_real)};
static PyObject *__pyx_pf_3kpm_3mom_3_expec_csr_real(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_indices = 0;
  PyArrayObject *__pyx_v_indptr = 0;
  PyArrayObject *__pyx_v_data = 0;
  PyArrayObject *__pyx_v_state = 0;
  int __pyx_v_limit;
  PyArrayObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_v___modified__ = NULL;
  int __pyx_v_rank;
  PyObject *__pyx_v_do_return = NULL;
  int *__pyx_v_ind;
  int *__pyx_v_ptr;
  double *__pyx_v_dat;
  double *__pyx_v_mom;
  double *__pyx_v_sta;
  double *__pyx_v_phi0;
  double *__pyx_v_phi1;
  double *__pyx_v_phi2;
  double __pyx_v_m0;
  double __pyx_v_m1;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  Py_buffer __pyx_bstruct_out;
  Py_ssize_t __pyx_bstride_0_out = 0;
  Py_ssize_t __pyx_bshape_0_out = 0;
  Py_buffer __pyx_bstruct_state;
  Py_ssize_t __pyx_bstride_0_state = 0;
  Py_ssize_t __pyx_bshape_0_state = 0;
  Py_buffer __pyx_bstruct_data;
  Py_ssize_t __pyx_bstride_0_data = 0;
  Py_ssize_t __pyx_bshape_0_data = 0;
  Py_buffer __pyx_bstruct_indptr;
  Py_ssize_t __pyx_bstride_0_indptr = 0;
  Py_ssize_t __pyx_bshape_0_indptr = 0;
  Py_buffer __pyx_bstruct_indices;
  Py_ssize_t __pyx_bstride_0_indices = 0;
  Py_ssize_t __pyx_bshape_0_indices = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__indptr,&__pyx_n_s__data,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_expec_csr_real");
  __pyx_self = __pyx_self;
  {
    PyObject* values[6] = {0,0,0,0,0,0};

  /* "kpm/mom.pyx":117
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_real(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     numpy.ndarray[int, mode="c"] indptr,
 *                     numpy.ndarray[double, mode="c"] data,
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_3_expec_csr_real, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s___expec_csr_real, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line118")'> 118:                     numpy.ndarray[int, mode="c"] indptr,</pre>
<pre id='line118' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119:                     numpy.ndarray[double, mode="c"] data,</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120:                     numpy.ndarray[double, mode="c"] state,</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line121")'> 121:                     int limit, numpy.ndarray[double, mode="c"] out=None):</pre>
<pre id='line121' class='code' style='background-color: #FFFF16'>
    /* "kpm/mom.pyx":121
 *                     numpy.ndarray[double, mode="c"] data,
 *                     numpy.ndarray[double, mode="c"] state,
 *                     int limit, numpy.ndarray[double, mode="c"] out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """_expec_csr_real(numpy.ndarray[int, mode="c"]    indices,
 *                     numpy.ndarray[int, mode="c"]    indptr,
 */
    values[5] = (PyObject *)((PyArrayObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indptr);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real", 0, 5, 6, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real", 0, 5, 6, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real", 0, 5, 6, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[4])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real", 0, 5, 6, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "_expec_csr_real") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = ((PyArrayObject *)values[0]);
    __pyx_v_indptr = ((PyArrayObject *)values[1]);
    __pyx_v_data = ((PyArrayObject *)values[2]);
    __pyx_v_state = ((PyArrayObject *)values[3]);
    __pyx_v_limit = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_limit == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_out = ((PyArrayObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_real", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_out);
  __pyx_bstruct_indices.buf = NULL;
  __pyx_bstruct_indptr.buf = NULL;
  __pyx_bstruct_data.buf = NULL;
  __pyx_bstruct_state.buf = NULL;
  __pyx_bstruct_out.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indices), __pyx_ptype_5numpy_ndarray, 1, "indices", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indptr), __pyx_ptype_5numpy_ndarray, 1, "indptr", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 119; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_state), __pyx_ptype_5numpy_ndarray, 1, "state", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 120; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_out), __pyx_ptype_5numpy_ndarray, 1, "out", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 121; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
  __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
  __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
  __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
  __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 117; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
  __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     """_expec_csr_real(numpy.ndarray[int, mode="c"]    indices,</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:                     numpy.ndarray[int, mode="c"]    indptr,</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line124")'> 124:                     numpy.ndarray[double, mode="c"] data,</pre>
<pre id='line124' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125:                     numpy.ndarray[double, mode="c"] state,</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126:                     int                             limit,</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127:                     numpy.ndarray[double, mode="c"] out=None)</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line128")'> 128: </pre>
<pre id='line128' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129:     Calculate real Chebychev moments for expectation values of the form</pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130:     &lt;a|T_n(H)|a&gt; for a real state vector |a&gt; "state" and a real CSR matrix H,</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line131")'> 131:     defined by column indices "indices", row pointer "indptr" and non-zero</pre>
<pre id='line131' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:     values "data". Specify required number of moments "limit" (truncation</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line133")'> 133:     limit). If "out" is not None, store the results in "out" instead of</pre>
<pre id='line133' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134:     returning them.</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135: </pre>
<pre id='line135' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line136")'> 136:     """</pre>
<pre id='line136' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line137")'> 137:     __created__ = '2012-08-19'</pre>
<pre id='line137' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":137
 * 
 *     """
 *     __created__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __modified__ = '2012-09-05'
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line138")'> 138:     __modified__ = '2012-09-05'</pre>
<pre id='line138' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":138
 *     """
 *     __created__ = '2012-08-19'
 *     __modified__ = '2012-09-05'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # prepare
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
  __pyx_v___modified__ = ((PyObject *)__pyx_kp_s_17);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line139")'> 139: </pre>
<pre id='line139' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140:     # prepare</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line141")'> 141:     cdef int rank = len(indptr)-1</pre>
<pre id='line141' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":141
 * 
 *     # prepare
 *     cdef int rank = len(indptr)-1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_indptr));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_rank = (__pyx_t_1 - 1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line142")'> 142:     if len(state) != rank:</pre>
<pre id='line142' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":142
 *     # prepare
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_state));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 142; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = (__pyx_t_1 != __pyx_v_rank);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line143")'> 143:         raise ValueError('bad state, must be equal to the rank of the matrix')</pre>
<pre id='line143' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":143
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_19), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "kpm/mom.pyx":143
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
  __pyx_k_tuple_19 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_19)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 143; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_19));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_18));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_19, 0, ((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_19));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line144")'> 144:     if limit &lt; 1:</pre>
<pre id='line144' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":144
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 */
  __pyx_t_2 = (__pyx_v_limit <code><</code> 1);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line145")'> 145:         raise ValueError('bad truncation limit, expecting positive integer')</pre>
<pre id='line145' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":145
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_20), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "kpm/mom.pyx":145
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
  __pyx_k_tuple_20 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_20)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_20));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_20, 0, ((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_20));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line146")'> 146:     do_return = out is None</pre>
<pre id='line146' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":146
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if out is None:
 *         out = numpy.empty(limit, dtype=float)
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_v_do_return = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line147")'> 147:     if out is None:</pre>
<pre id='line147' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":147
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 *     if out is None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.empty(limit, dtype=float)
 *     if not out.flags['C_CONTIGUOUS']:
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line148")'> 148:         out = numpy.empty(limit, dtype=float)</pre>
<pre id='line148' class='code' style='background-color: #FFFF25'>
    /* "kpm/mom.pyx":148
 *     do_return = out is None
 *     if out is None:
 *         out = numpy.empty(limit, dtype=float)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_limit);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 148; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line149")'> 149:     if not out.flags['C_CONTIGUOUS']:</pre>
<pre id='line149' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":149
 *     if out is None:
 *         out = numpy.empty(limit, dtype=float)
 *     if not out.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_out), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line150")'> 150:         out = numpy.ascontiguousarray(out)</pre>
<pre id='line150' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":150
 *         out = numpy.empty(limit, dtype=float)
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_out));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L9;
  }
  __pyx_L9:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line151")'> 151:     if not indices.flags['C_CONTIGUOUS']:</pre>
<pre id='line151' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":151
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indices), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 151; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line152")'> 152:         indices = numpy.ascontiguousarray(indices)</pre>
<pre id='line152' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":152
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indices));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indices));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indices));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
      __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indices));
    __pyx_v_indices = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line153")'> 153:     if not indptr.flags['C_CONTIGUOUS']:</pre>
<pre id='line153' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":153
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indptr), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 153; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line154")'> 154:         indptr = numpy.ascontiguousarray(indptr)</pre>
<pre id='line154' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":154
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indptr));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indptr));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indptr));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_14 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
      __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 154; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_14 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indptr));
    __pyx_v_indptr = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L11;
  }
  __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line155")'> 155:     if not data.flags['C_CONTIGUOUS']:</pre>
<pre id='line155' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":155
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_data), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 155; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line156")'> 156:         data = numpy.ascontiguousarray(data)</pre>
<pre id='line156' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":156
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_data));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_data));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_15 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
      __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_data));
    __pyx_v_data = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L12;
  }
  __pyx_L12:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line157")'> 157:     if not state.flags['C_CONTIGUOUS']:</pre>
<pre id='line157' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":157
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         state = numpy.ascontiguousarray(state)
 * 
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_state), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 157; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line158")'> 158:         state = numpy.ascontiguousarray(state)</pre>
<pre id='line158' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":158
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # calculate
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_state));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_state));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_state));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_16 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_t_16, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
      __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 158; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_state));
    __pyx_v_state = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L13;
  }
  __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159: </pre>
<pre id='line159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160:     # calculate</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161:     cdef:</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:         int *ind = &lt;int*&gt;indices.data</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":162
 *     # calculate
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int *ptr = <code><</code>int*>indptr.data
 *         double *dat = <code><</code>double*>data.data
 */
  __pyx_v_ind = ((int *)__pyx_v_indices->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:         int *ptr = &lt;int*&gt;indptr.data</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":163
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *dat = <code><</code>double*>data.data
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 */
  __pyx_v_ptr = ((int *)__pyx_v_indptr->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:         double *dat = &lt;double*&gt;data.data</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":164
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data
 *         double *dat = <code><</code>double*>data.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 *         double *sta = <code><</code>double*>state.data
 */
  __pyx_v_dat = ((double *)__pyx_v_data->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:         double *mom = &lt;double*&gt;out.data  # Py_mom.data</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":165
 *         int *ptr = <code><</code>int*>indptr.data
 *         double *dat = <code><</code>double*>data.data
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *sta = <code><</code>double*>state.data
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 */
  __pyx_v_mom = ((double *)__pyx_v_out->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:         double *sta = &lt;double*&gt;state.data</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":166
 *         double *dat = <code><</code>double*>data.data
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 *         double *sta = <code><</code>double*>state.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 */
  __pyx_v_sta = ((double *)__pyx_v_state->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:         double *phi0 = &lt;double*&gt;libc.stdlib.malloc(sizeof(double)*rank)</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":167
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 *         double *sta = <code><</code>double*>state.data
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi2 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 */
  __pyx_v_phi0 = ((double *)malloc(((sizeof(double)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line168")'> 168:         double *phi1 = &lt;double*&gt;libc.stdlib.malloc(sizeof(double)*rank)</pre>
<pre id='line168' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":168
 *         double *sta = <code><</code>double*>state.data
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *phi2 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double m0, m1  # temporary reduction variables
 */
  __pyx_v_phi1 = ((double *)malloc(((sizeof(double)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line169")'> 169:         double *phi2 = &lt;double*&gt;libc.stdlib.malloc(sizeof(double)*rank)</pre>
<pre id='line169' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":169
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi2 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double m0, m1  # temporary reduction variables
 *         int    i, j, k
 */
  __pyx_v_phi2 = ((double *)malloc(((sizeof(double)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line170")'> 170:         double m0, m1  # temporary reduction variables</pre>
<pre id='line170' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171:         int    i, j, k</pre>
<pre id='line171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172:     try:</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":172
 *         double m0, m1  # temporary reduction variables
 *         int    i, j, k
 *     try:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # calculate first two orders of the Chebychev expansion
 *         for k in range(rank):
 */
  /*try:*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173:         # calculate first two orders of the Chebychev expansion</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174:         for k in range(rank):</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":174
 *     try:
 *         # calculate first two orders of the Chebychev expansion
 *         for k in range(rank):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real(phi0, phi0, rank)
 */
    __pyx_t_8 = __pyx_v_rank;
    for (__pyx_t_17 = 0; __pyx_t_17 <code><</code> __pyx_t_8; __pyx_t_17+=1) {
      __pyx_v_k = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line175")'> 175:             phi0[k] = sta[k]</pre>
<pre id='line175' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":175
 *         # calculate first two orders of the Chebychev expansion
 *         for k in range(rank):
 *             phi0[k] = sta[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[0] = dot_real(phi0, phi0, rank)
 *         matvec_csr_real(ind, ptr, dat, rank, phi0, phi1)
 */
      (__pyx_v_phi0[__pyx_v_k]) = (__pyx_v_sta[__pyx_v_k]);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:         mom[0] = dot_real(phi0, phi0, rank)</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":176
 *         for k in range(rank):
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real(phi0, phi0, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         matvec_csr_real(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_real(phi1, phi0, rank)
 */
    (__pyx_v_mom[0]) = __pyx_f_3kpm_3mom_dot_real(__pyx_v_phi0, __pyx_v_phi0, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:         matvec_csr_real(ind, ptr, dat, rank, phi0, phi1)</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":177
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real(phi0, phi0, rank)
 *         matvec_csr_real(ind, ptr, dat, rank, phi0, phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[1] = dot_real(phi1, phi0, rank)
 * 
 */
    __pyx_f_3kpm_3mom_matvec_csr_real(__pyx_v_ind, __pyx_v_ptr, __pyx_v_dat, __pyx_v_rank, __pyx_v_phi0, __pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:         mom[1] = dot_real(phi1, phi0, rank)</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":178
 *         mom[0] = dot_real(phi0, phi0, rank)
 *         matvec_csr_real(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_real(phi1, phi0, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # main iteration loop
 */
    (__pyx_v_mom[1]) = __pyx_f_3kpm_3mom_dot_real(__pyx_v_phi1, __pyx_v_phi0, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179: </pre>
<pre id='line179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:         # main iteration loop</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181:         for i in range(1, limit/2):</pre>
<pre id='line181' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":181
 * 
 *         # main iteration loop
 *         for i in range(1, limit/2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # initialize temporary reduction variables
 *             m0 = 0
 */
    __pyx_t_18 = (__pyx_v_limit / 2);
    for (__pyx_t_8 = 1; __pyx_t_8 <code><</code> __pyx_t_18; __pyx_t_8+=1) {
      __pyx_v_i = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:             # initialize temporary reduction variables</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:             m0 = 0</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":183
 *         for i in range(1, limit/2):
 *             # initialize temporary reduction variables
 *             m0 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             m1 = 0
 * 
 */
      __pyx_v_m0 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184:             m1 = 0</pre>
<pre id='line184' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":184
 *             # initialize temporary reduction variables
 *             m0 = 0
 *             m1 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for k in range(rank):
 */
      __pyx_v_m1 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185: </pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:             for k in range(rank):</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":186
 *             m1 = 0
 * 
 *             for k in range(rank):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 */
      __pyx_t_17 = __pyx_v_rank;
      for (__pyx_t_19 = 0; __pyx_t_19 <code><</code> __pyx_t_17; __pyx_t_19+=1) {
        __pyx_v_k = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187:                 # CSR-matrix-vector multiplication</pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188:                 phi2[k] = 0</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":188
 *             for k in range(rank):
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 */
        (__pyx_v_phi2[__pyx_v_k]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189:                 for j in range(ptr[k], ptr[k+1]):</pre>
<pre id='line189' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":189
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]
 */
        __pyx_t_20 = (__pyx_v_ptr[(__pyx_v_k + 1)]);
        for (__pyx_t_21 = (__pyx_v_ptr[__pyx_v_k]); __pyx_t_21 <code><</code> __pyx_t_20; __pyx_t_21+=1) {
          __pyx_v_j = __pyx_t_21;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190:                     phi2[k] += 2*dat[j]*phi1[ind[j]]</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'>
          /* "kpm/mom.pyx":190
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 phi2[k] -= phi0[k]
 * 
 */
          __pyx_t_22 = __pyx_v_k;
          (__pyx_v_phi2[__pyx_t_22]) = ((__pyx_v_phi2[__pyx_t_22]) + ((2.0 * (__pyx_v_dat[__pyx_v_j])) * (__pyx_v_phi1[(__pyx_v_ind[__pyx_v_j])])));
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191:                 phi2[k] -= phi0[k]</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":191
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # calculate Chebychev moments, part 1
 */
        __pyx_t_20 = __pyx_v_k;
        (__pyx_v_phi2[__pyx_t_20]) = ((__pyx_v_phi2[__pyx_t_20]) - (__pyx_v_phi0[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192: </pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193:                 # calculate Chebychev moments, part 1</pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:                 # use temporary reduction variables so that Cython/OpenMP</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:                 # understands</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:                 m0 += 2*phi1[k]*phi1[k]  # reduction for mom[i*2]</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":196
 *                 # use temporary reduction variables so that Cython/OpenMP
 *                 # understands
 *                 m0 += 2*phi1[k]*phi1[k]  # reduction for mom[i*2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 m1 += 2*phi2[k]*phi1[k]  # reduction for mom[i*2+1]
 * 
 */
        __pyx_v_m0 = (__pyx_v_m0 + ((2.0 * (__pyx_v_phi1[__pyx_v_k])) * (__pyx_v_phi1[__pyx_v_k])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:                 m1 += 2*phi2[k]*phi1[k]  # reduction for mom[i*2+1]</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":197
 *                 # understands
 *                 m0 += 2*phi1[k]*phi1[k]  # reduction for mom[i*2]
 *                 m1 += 2*phi2[k]*phi1[k]  # reduction for mom[i*2+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # calculate Chebychev moments, part 2
 */
        __pyx_v_m1 = (__pyx_v_m1 + ((2.0 * (__pyx_v_phi2[__pyx_v_k])) * (__pyx_v_phi1[__pyx_v_k])));
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198: </pre>
<pre id='line198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:             # calculate Chebychev moments, part 2</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:             mom[i*2] = m0-mom[0]</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":200
 * 
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = m0-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             mom[i*2+1] = m1-mom[1]
 * 
 */
      (__pyx_v_mom[(__pyx_v_i * 2)]) = (__pyx_v_m0 - (__pyx_v_mom[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:             mom[i*2+1] = m1-mom[1]</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":201
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = m0-mom[0]
 *             mom[i*2+1] = m1-mom[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # shift states circular
 */
      (__pyx_v_mom[((__pyx_v_i * 2) + 1)]) = (__pyx_v_m1 - (__pyx_v_mom[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202: </pre>
<pre id='line202' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:             # shift states circular</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:             shift3_real(&amp;phi0, &amp;phi1, &amp;phi2)</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":204
 * 
 *             # shift states circular
 *             shift3_real(&phi0, &phi1, &phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if limit % 2 == 1:
 */
      __pyx_f_3kpm_3mom_shift3_real((&__pyx_v_phi0), (&__pyx_v_phi1), (&__pyx_v_phi2));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line205")'> 205: </pre>
<pre id='line205' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line206")'> 206:         if limit % 2 == 1:</pre>
<pre id='line206' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":206
 *             shift3_real(&phi0, &phi1, &phi2)
 * 
 *         if limit % 2 == 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 */
    __pyx_t_12 = ((__pyx_v_limit % 2) == 1);
    if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line207")'> 207:             # calculate last Chebychev moment in case of an odd truncation</pre>
<pre id='line207' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line208")'> 208:             # number</pre>
<pre id='line208' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line209")'> 209:             mom[limit-1] = 2*dot_real(phi1, phi1, rank)-mom[0]</pre>
<pre id='line209' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":209
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 *             mom[limit-1] = 2*dot_real(phi1, phi1, rank)-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     finally:
 */
      (__pyx_v_mom[(__pyx_v_limit - 1)]) = ((2.0 * __pyx_f_3kpm_3mom_dot_real(__pyx_v_phi1, __pyx_v_phi1, __pyx_v_rank)) - (__pyx_v_mom[0]));
      goto __pyx_L25;
    }
    __pyx_L25:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line210")'> 210: </pre>
<pre id='line210' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211:     finally:</pre>
<pre id='line211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line212")'> 212:         # clean up memory</pre>
<pre id='line212' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line213")'> 213:         libc.stdlib.free(phi0)</pre>
<pre id='line213' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":213
 *     finally:
 *         # clean up memory
 *         libc.stdlib.free(phi0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)
 */
  /*finally:*/ {
    free(__pyx_v_phi0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214:         libc.stdlib.free(phi1)</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":214
 *         # clean up memory
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi2)
 * 
 */
    free(__pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215:         libc.stdlib.free(phi2)</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":215
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # return
 */
    free(__pyx_v_phi2);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216: </pre>
<pre id='line216' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217:     # return</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line218")'> 218:     return &lt;object&gt;out if do_return else None</pre>
<pre id='line218' class='code' style='background-color: #FFFF2b'>
  /* "kpm/mom.pyx":218
 * 
 *     # return
 *     return <code><</code>object>out if do_return else None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_do_return);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 218; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (__pyx_t_12) {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = ((PyObject *)__pyx_v_out);
  } else {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    __pyx_t_5 = Py_None;
  }
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_real", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___modified__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_do_return);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line219")'> 219: </pre>
<pre id='line219' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: </pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221: @cython.cdivision(True)</pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222: @cython.boundscheck(False)</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line223")'> 223: def _expec_csr_real_omp(numpy.ndarray[int, mode="c"] indices,</pre>
<pre id='line223' class='code' style='background-color: #FFFF8d'>
/* "kpm/mom.pyx":223
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_real_omp(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         numpy.ndarray[int, mode="c"] indptr,
 *                         numpy.ndarray[double, mode="c"] data,
 */

static PyObject *__pyx_pf_3kpm_3mom_4_expec_csr_real_omp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3kpm_3mom_4_expec_csr_real_omp[] = "_expec_csr_real_omp(numpy.ndarray[int, mode=\"c\"]    indices,\n                        numpy.ndarray[int, mode=\"c\"]    indptr,\n                        numpy.ndarray[double, mode=\"c\"] data,\n                        numpy.ndarray[double, mode=\"c\"] state,\n                        int                             limit,\n                        numpy.ndarray[double, mode=\"c\"] out=None)\n\n    Calculate real Chebychev moments for expectation values of the form\n    <code><</code>a|T_n(H)|a> for a real state vector |a> \"state\" and a real CSR matrix H,\n    defined by column indices \"indices\", row pointer \"indptr\" and non-zero\n    values \"data\". Specify required number of moments \"limit\" (truncation\n    limit). If \"out\" is not None, store the results in \"out\" instead of\n    returning them.\n\n    This is the OpenMP version of the function, using parallel for-loops.";
static PyMethodDef __pyx_mdef_3kpm_3mom_4_expec_csr_real_omp = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("_expec_csr_real_omp"), (PyCFunction)__pyx_pf_3kpm_3mom_4_expec_csr_real_omp, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3kpm_3mom_4_expec_csr_real_omp)};
static PyObject *__pyx_pf_3kpm_3mom_4_expec_csr_real_omp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_indices = 0;
  PyArrayObject *__pyx_v_indptr = 0;
  PyArrayObject *__pyx_v_data = 0;
  PyArrayObject *__pyx_v_state = 0;
  int __pyx_v_limit;
  PyArrayObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_v___modified__ = NULL;
  int __pyx_v_rank;
  PyObject *__pyx_v_do_return = NULL;
  int *__pyx_v_ind;
  int *__pyx_v_ptr;
  double *__pyx_v_dat;
  double *__pyx_v_mom;
  double *__pyx_v_sta;
  double *__pyx_v_phi0;
  double *__pyx_v_phi1;
  double *__pyx_v_phi2;
  double __pyx_v_m0;
  double __pyx_v_m1;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  Py_buffer __pyx_bstruct_out;
  Py_ssize_t __pyx_bstride_0_out = 0;
  Py_ssize_t __pyx_bshape_0_out = 0;
  Py_buffer __pyx_bstruct_state;
  Py_ssize_t __pyx_bstride_0_state = 0;
  Py_ssize_t __pyx_bshape_0_state = 0;
  Py_buffer __pyx_bstruct_data;
  Py_ssize_t __pyx_bstride_0_data = 0;
  Py_ssize_t __pyx_bshape_0_data = 0;
  Py_buffer __pyx_bstruct_indptr;
  Py_ssize_t __pyx_bstride_0_indptr = 0;
  Py_ssize_t __pyx_bshape_0_indptr = 0;
  Py_buffer __pyx_bstruct_indices;
  Py_ssize_t __pyx_bstride_0_indices = 0;
  Py_ssize_t __pyx_bshape_0_indices = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__indptr,&__pyx_n_s__data,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_expec_csr_real_omp");
  __pyx_self = __pyx_self;
  {
    PyObject* values[6] = {0,0,0,0,0,0};

  /* "kpm/mom.pyx":223
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_real_omp(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                         numpy.ndarray[int, mode="c"] indptr,
 *                         numpy.ndarray[double, mode="c"] data,
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_4_expec_csr_real_omp, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s___expec_csr_real_omp, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224:                         numpy.ndarray[int, mode="c"] indptr,</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line225")'> 225:                         numpy.ndarray[double, mode="c"] data,</pre>
<pre id='line225' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:                         numpy.ndarray[double, mode="c"] state,</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line227")'> 227:                         int limit, numpy.ndarray[double, mode="c"] out=None):</pre>
<pre id='line227' class='code' style='background-color: #FFFF16'>
    /* "kpm/mom.pyx":227
 *                         numpy.ndarray[double, mode="c"] data,
 *                         numpy.ndarray[double, mode="c"] state,
 *                         int limit, numpy.ndarray[double, mode="c"] out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """_expec_csr_real_omp(numpy.ndarray[int, mode="c"]    indices,
 *                         numpy.ndarray[int, mode="c"]    indptr,
 */
    values[5] = (PyObject *)((PyArrayObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indptr);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real_omp", 0, 5, 6, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real_omp", 0, 5, 6, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real_omp", 0, 5, 6, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[4])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real_omp", 0, 5, 6, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "_expec_csr_real_omp") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = ((PyArrayObject *)values[0]);
    __pyx_v_indptr = ((PyArrayObject *)values[1]);
    __pyx_v_data = ((PyArrayObject *)values[2]);
    __pyx_v_state = ((PyArrayObject *)values[3]);
    __pyx_v_limit = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_limit == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_out = ((PyArrayObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_real_omp", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_real_omp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_out);
  __pyx_bstruct_indices.buf = NULL;
  __pyx_bstruct_indptr.buf = NULL;
  __pyx_bstruct_data.buf = NULL;
  __pyx_bstruct_state.buf = NULL;
  __pyx_bstruct_out.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indices), __pyx_ptype_5numpy_ndarray, 1, "indices", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indptr), __pyx_ptype_5numpy_ndarray, 1, "indptr", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 224; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_state), __pyx_ptype_5numpy_ndarray, 1, "state", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_out), __pyx_ptype_5numpy_ndarray, 1, "out", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
  __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
  __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
  __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
  __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
  __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228:     """_expec_csr_real_omp(numpy.ndarray[int, mode="c"]    indices,</pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:                         numpy.ndarray[int, mode="c"]    indptr,</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:                         numpy.ndarray[double, mode="c"] data,</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line231")'> 231:                         numpy.ndarray[double, mode="c"] state,</pre>
<pre id='line231' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line232")'> 232:                         int                             limit,</pre>
<pre id='line232' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233:                         numpy.ndarray[double, mode="c"] out=None)</pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234: </pre>
<pre id='line234' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235:     Calculate real Chebychev moments for expectation values of the form</pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:     &lt;a|T_n(H)|a&gt; for a real state vector |a&gt; "state" and a real CSR matrix H,</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237:     defined by column indices "indices", row pointer "indptr" and non-zero</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:     values "data". Specify required number of moments "limit" (truncation</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:     limit). If "out" is not None, store the results in "out" instead of</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240:     returning them.</pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241: </pre>
<pre id='line241' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242:     This is the OpenMP version of the function, using parallel for-loops."""</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line243")'> 243:     __created__ = '2012-08-18'</pre>
<pre id='line243' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":243
 * 
 *     This is the OpenMP version of the function, using parallel for-loops."""
 *     __created__ = '2012-08-18'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __modified__ = '2012-09-05'
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_21));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_21);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line244")'> 244:     __modified__ = '2012-09-05'</pre>
<pre id='line244' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":244
 *     This is the OpenMP version of the function, using parallel for-loops."""
 *     __created__ = '2012-08-18'
 *     __modified__ = '2012-09-05'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # prepare
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
  __pyx_v___modified__ = ((PyObject *)__pyx_kp_s_17);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245: </pre>
<pre id='line245' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246:     # prepare</pre>
<pre id='line246' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line247")'> 247:     cdef int rank = len(indptr)-1</pre>
<pre id='line247' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":247
 * 
 *     # prepare
 *     cdef int rank = len(indptr)-1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_indptr));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 247; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_rank = (__pyx_t_1 - 1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line248")'> 248:     if len(state) != rank:</pre>
<pre id='line248' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":248
 *     # prepare
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_state));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 248; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = (__pyx_t_1 != __pyx_v_rank);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line249")'> 249:         raise ValueError('bad state, must be equal to the rank of the matrix')</pre>
<pre id='line249' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":249
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_22), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "kpm/mom.pyx":249
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
  __pyx_k_tuple_22 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_22)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 249; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_22));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_18));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_22, 0, ((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_22));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250:     if limit &lt; 1:</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":250
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 */
  __pyx_t_2 = (__pyx_v_limit <code><</code> 1);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line251")'> 251:         raise ValueError('bad truncation limit, expecting positive integer')</pre>
<pre id='line251' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":251
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_23), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "kpm/mom.pyx":251
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
  __pyx_k_tuple_23 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_23)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 251; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_23));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_23, 0, ((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_23));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line252")'> 252:     do_return = out is None</pre>
<pre id='line252' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":252
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if out is None:
 *         out = numpy.empty(limit, dtype=float)
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_v_do_return = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:     if out is None:</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":253
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 *     if out is None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.empty(limit, dtype=float)
 *     if not out.flags['C_CONTIGUOUS']:
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line254")'> 254:         out = numpy.empty(limit, dtype=float)</pre>
<pre id='line254' class='code' style='background-color: #FFFF25'>
    /* "kpm/mom.pyx":254
 *     do_return = out is None
 *     if out is None:
 *         out = numpy.empty(limit, dtype=float)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_limit);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyFloat_Type)))) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 254; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line255")'> 255:     if not out.flags['C_CONTIGUOUS']:</pre>
<pre id='line255' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":255
 *     if out is None:
 *         out = numpy.empty(limit, dtype=float)
 *     if not out.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_out), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 255; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line256")'> 256:         out = numpy.ascontiguousarray(out)</pre>
<pre id='line256' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":256
 *         out = numpy.empty(limit, dtype=float)
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_out));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 256; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L9;
  }
  __pyx_L9:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line257")'> 257:     if not indices.flags['C_CONTIGUOUS']:</pre>
<pre id='line257' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":257
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indices), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line258")'> 258:         indices = numpy.ascontiguousarray(indices)</pre>
<pre id='line258' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":258
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indices));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indices));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indices));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
      __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 258; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indices));
    __pyx_v_indices = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line259")'> 259:     if not indptr.flags['C_CONTIGUOUS']:</pre>
<pre id='line259' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":259
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indptr), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line260")'> 260:         indptr = numpy.ascontiguousarray(indptr)</pre>
<pre id='line260' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":260
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indptr));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indptr));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indptr));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_14 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
      __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_14 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indptr));
    __pyx_v_indptr = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L11;
  }
  __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line261")'> 261:     if not data.flags['C_CONTIGUOUS']:</pre>
<pre id='line261' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":261
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_data), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 261; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line262")'> 262:         data = numpy.ascontiguousarray(data)</pre>
<pre id='line262' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":262
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_data));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_data));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_15 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
      __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 262; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_data));
    __pyx_v_data = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L12;
  }
  __pyx_L12:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line263")'> 263:     if not state.flags['C_CONTIGUOUS']:</pre>
<pre id='line263' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":263
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         state = numpy.ascontiguousarray(state)
 * 
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_state), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 263; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line264")'> 264:         state = numpy.ascontiguousarray(state)</pre>
<pre id='line264' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":264
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # calculate
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_state));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_state));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_state));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_16 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_t_16, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
      __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 264; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_state));
    __pyx_v_state = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L13;
  }
  __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265: </pre>
<pre id='line265' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266:     # calculate</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267:     cdef:</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268:         int *ind = &lt;int*&gt;indices.data</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":268
 *     # calculate
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int *ptr = <code><</code>int*>indptr.data
 *         double *dat = <code><</code>double*>data.data
 */
  __pyx_v_ind = ((int *)__pyx_v_indices->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269:         int *ptr = &lt;int*&gt;indptr.data</pre>
<pre id='line269' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":269
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *dat = <code><</code>double*>data.data
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 */
  __pyx_v_ptr = ((int *)__pyx_v_indptr->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:         double *dat = &lt;double*&gt;data.data</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":270
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data
 *         double *dat = <code><</code>double*>data.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 *         double *sta = <code><</code>double*>state.data
 */
  __pyx_v_dat = ((double *)__pyx_v_data->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:         double *mom = &lt;double*&gt;out.data  # Py_mom.data</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":271
 *         int *ptr = <code><</code>int*>indptr.data
 *         double *dat = <code><</code>double*>data.data
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *sta = <code><</code>double*>state.data
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 */
  __pyx_v_mom = ((double *)__pyx_v_out->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272:         double *sta = &lt;double*&gt;state.data</pre>
<pre id='line272' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":272
 *         double *dat = <code><</code>double*>data.data
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 *         double *sta = <code><</code>double*>state.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 */
  __pyx_v_sta = ((double *)__pyx_v_state->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line273")'> 273:         double *phi0 = &lt;double*&gt;libc.stdlib.malloc(sizeof(double)*rank)</pre>
<pre id='line273' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":273
 *         double *mom = <code><</code>double*>out.data  # Py_mom.data
 *         double *sta = <code><</code>double*>state.data
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi2 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 */
  __pyx_v_phi0 = ((double *)malloc(((sizeof(double)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274:         double *phi1 = &lt;double*&gt;libc.stdlib.malloc(sizeof(double)*rank)</pre>
<pre id='line274' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":274
 *         double *sta = <code><</code>double*>state.data
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double *phi2 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double m0, m1  # temporary reduction variables
 */
  __pyx_v_phi1 = ((double *)malloc(((sizeof(double)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275:         double *phi2 = &lt;double*&gt;libc.stdlib.malloc(sizeof(double)*rank)</pre>
<pre id='line275' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":275
 *         double *phi0 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi1 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)
 *         double *phi2 = <code><</code>double*>libc.stdlib.malloc(sizeof(double)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double m0, m1  # temporary reduction variables
 *         int    i, j, k
 */
  __pyx_v_phi2 = ((double *)malloc(((sizeof(double)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276:         double m0, m1  # temporary reduction variables</pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line277")'> 277:         int    i, j, k</pre>
<pre id='line277' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278:     try:</pre>
<pre id='line278' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":278
 *         double m0, m1  # temporary reduction variables
 *         int    i, j, k
 *     try:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):
 */
  /*try:*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279:         # calculate first two orders of the Chebychev expansion</pre>
<pre id='line279' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280:         for k in prange(rank, nogil=True):</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":280
 *     try:
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real_omp(phi0, phi0, rank)
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save = NULL;
        #endif
        Py_UNBLOCK_THREADS
        /*try:*/ {
          __pyx_t_8 = __pyx_v_rank;
          if (1 == 0) abort();
          {
              __pyx_t_18 = (__pyx_t_8 - 0) / 1;
              if (__pyx_t_18 > 0)
              {
                  __pyx_v_k = 0;
                  #ifdef _OPENMP
                  #pragma omp parallel
                  #endif /* _OPENMP */
                  {
                      #ifdef _OPENMP
                      #pragma omp for firstprivate(__pyx_v_k) lastprivate(__pyx_v_k)
                      #endif /* _OPENMP */
                      for (__pyx_t_17 = 0; __pyx_t_17 <code><</code> __pyx_t_18; __pyx_t_17++){
                          {
                              __pyx_v_k = 0 + 1 * __pyx_t_17;

        /* "kpm/mom.pyx":280
 *     try:
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real_omp(phi0, phi0, rank)
 */
        /*finally:*/ {
          Py_BLOCK_THREADS
        }
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281:             phi0[k] = sta[k]</pre>
<pre id='line281' class='code' style='background-color: #FFFFff'>
                              /* "kpm/mom.pyx":281
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):
 *             phi0[k] = sta[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[0] = dot_real_omp(phi0, phi0, rank)
 *         matvec_csr_real_omp(ind, ptr, dat, rank, phi0, phi1)
 */
                              (__pyx_v_phi0[__pyx_v_k]) = (__pyx_v_sta[__pyx_v_k]);
                          }
                      }
                  }
              }
          }
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282:         mom[0] = dot_real_omp(phi0, phi0, rank)</pre>
<pre id='line282' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":282
 *         for k in prange(rank, nogil=True):
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real_omp(phi0, phi0, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         matvec_csr_real_omp(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_real_omp(phi1, phi0, rank)
 */
    (__pyx_v_mom[0]) = __pyx_f_3kpm_3mom_dot_real_omp(__pyx_v_phi0, __pyx_v_phi0, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283:         matvec_csr_real_omp(ind, ptr, dat, rank, phi0, phi1)</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":283
 *             phi0[k] = sta[k]
 *         mom[0] = dot_real_omp(phi0, phi0, rank)
 *         matvec_csr_real_omp(ind, ptr, dat, rank, phi0, phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[1] = dot_real_omp(phi1, phi0, rank)
 * 
 */
    __pyx_f_3kpm_3mom_matvec_csr_real_omp(__pyx_v_ind, __pyx_v_ptr, __pyx_v_dat, __pyx_v_rank, __pyx_v_phi0, __pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284:         mom[1] = dot_real_omp(phi1, phi0, rank)</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":284
 *         mom[0] = dot_real_omp(phi0, phi0, rank)
 *         matvec_csr_real_omp(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_real_omp(phi1, phi0, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # main iteration loop
 */
    (__pyx_v_mom[1]) = __pyx_f_3kpm_3mom_dot_real_omp(__pyx_v_phi1, __pyx_v_phi0, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285: </pre>
<pre id='line285' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286:         # main iteration loop</pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287:         for i in range(1, limit/2):</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":287
 * 
 *         # main iteration loop
 *         for i in range(1, limit/2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # initialize temporary reduction variables
 *             m0 = 0
 */
    __pyx_t_19 = (__pyx_v_limit / 2);
    for (__pyx_t_18 = 1; __pyx_t_18 <code><</code> __pyx_t_19; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288:             # initialize temporary reduction variables</pre>
<pre id='line288' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289:             m0 = 0</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":289
 *         for i in range(1, limit/2):
 *             # initialize temporary reduction variables
 *             m0 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             m1 = 0
 * 
 */
      __pyx_v_m0 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line290")'> 290:             m1 = 0</pre>
<pre id='line290' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":290
 *             # initialize temporary reduction variables
 *             m0 = 0
 *             m1 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for k in prange(rank, nogil=True):
 */
      __pyx_v_m1 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line291")'> 291: </pre>
<pre id='line291' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line292")'> 292:             for k in prange(rank, nogil=True):</pre>
<pre id='line292' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":292
 *             m1 = 0
 * 
 *             for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save = NULL;
          #endif
          Py_UNBLOCK_THREADS
          /*try:*/ {
            __pyx_t_17 = __pyx_v_rank;
            if (1 == 0) abort();
            {
                __pyx_t_20 = (__pyx_t_17 - 0) / 1;
                if (__pyx_t_20 > 0)
                {
                    __pyx_v_k = 0;
                    #ifdef _OPENMP
                    #pragma omp parallel
                    #endif /* _OPENMP */
                    {
                        #ifdef _OPENMP
                        #pragma omp for lastprivate(__pyx_v_j) reduction(+:__pyx_v_m0) firstprivate(__pyx_v_k) lastprivate(__pyx_v_k) reduction(+:__pyx_v_m1)
                        #endif /* _OPENMP */
                        for (__pyx_t_8 = 0; __pyx_t_8 <code><</code> __pyx_t_20; __pyx_t_8++){
                            {
                                __pyx_v_k = 0 + 1 * __pyx_t_8;
                                /* Initialize private variables to invalid values */
                                __pyx_v_j = ((int)0xbad0bad0);

          /* "kpm/mom.pyx":292
 *             m1 = 0
 * 
 *             for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 */
          /*finally:*/ {
            Py_BLOCK_THREADS
          }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line293")'> 293:                 # CSR-matrix-vector multiplication</pre>
<pre id='line293' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line294")'> 294:                 phi2[k] = 0</pre>
<pre id='line294' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":294
 *             for k in prange(rank, nogil=True):
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 */
                                (__pyx_v_phi2[__pyx_v_k]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line295")'> 295:                 for j in range(ptr[k], ptr[k+1]):</pre>
<pre id='line295' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":295
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]
 */
                                __pyx_t_21 = (__pyx_v_ptr[(__pyx_v_k + 1)]);
                                for (__pyx_t_22 = (__pyx_v_ptr[__pyx_v_k]); __pyx_t_22 <code><</code> __pyx_t_21; __pyx_t_22+=1) {
                                  __pyx_v_j = __pyx_t_22;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line296")'> 296:                     phi2[k] += 2*dat[j]*phi1[ind[j]]</pre>
<pre id='line296' class='code' style='background-color: #FFFFff'>
                                  /* "kpm/mom.pyx":296
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 phi2[k] -= phi0[k]
 * 
 */
                                  __pyx_t_23 = __pyx_v_k;
                                  (__pyx_v_phi2[__pyx_t_23]) = ((__pyx_v_phi2[__pyx_t_23]) + ((2.0 * (__pyx_v_dat[__pyx_v_j])) * (__pyx_v_phi1[(__pyx_v_ind[__pyx_v_j])])));
                                }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line297")'> 297:                 phi2[k] -= phi0[k]</pre>
<pre id='line297' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":297
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # calculate Chebychev moments, part 1
 */
                                __pyx_t_21 = __pyx_v_k;
                                (__pyx_v_phi2[__pyx_t_21]) = ((__pyx_v_phi2[__pyx_t_21]) - (__pyx_v_phi0[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line298")'> 298: </pre>
<pre id='line298' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line299")'> 299:                 # calculate Chebychev moments, part 1</pre>
<pre id='line299' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line300")'> 300:                 # use temporary reduction variables so that Cython/OpenMP</pre>
<pre id='line300' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line301")'> 301:                 # understands</pre>
<pre id='line301' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line302")'> 302:                 m0 += 2*phi1[k]*phi1[k]  # reduction for mom[i*2]</pre>
<pre id='line302' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":302
 *                 # use temporary reduction variables so that Cython/OpenMP
 *                 # understands
 *                 m0 += 2*phi1[k]*phi1[k]  # reduction for mom[i*2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 m1 += 2*phi2[k]*phi1[k]  # reduction for mom[i*2+1]
 * 
 */
                                __pyx_v_m0 = (__pyx_v_m0 + ((2.0 * (__pyx_v_phi1[__pyx_v_k])) * (__pyx_v_phi1[__pyx_v_k])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line303")'> 303:                 m1 += 2*phi2[k]*phi1[k]  # reduction for mom[i*2+1]</pre>
<pre id='line303' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":303
 *                 # understands
 *                 m0 += 2*phi1[k]*phi1[k]  # reduction for mom[i*2]
 *                 m1 += 2*phi2[k]*phi1[k]  # reduction for mom[i*2+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # calculate Chebychev moments, part 2
 */
                                __pyx_v_m1 = (__pyx_v_m1 + ((2.0 * (__pyx_v_phi2[__pyx_v_k])) * (__pyx_v_phi1[__pyx_v_k])));
                            }
                        }
                    }
                }
            }
          }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line304")'> 304: </pre>
<pre id='line304' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line305")'> 305:             # calculate Chebychev moments, part 2</pre>
<pre id='line305' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line306")'> 306:             mom[i*2] = m0-mom[0]</pre>
<pre id='line306' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":306
 * 
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = m0-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             mom[i*2+1] = m1-mom[1]
 * 
 */
      (__pyx_v_mom[(__pyx_v_i * 2)]) = (__pyx_v_m0 - (__pyx_v_mom[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line307")'> 307:             mom[i*2+1] = m1-mom[1]</pre>
<pre id='line307' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":307
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = m0-mom[0]
 *             mom[i*2+1] = m1-mom[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # shift states circular
 */
      (__pyx_v_mom[((__pyx_v_i * 2) + 1)]) = (__pyx_v_m1 - (__pyx_v_mom[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line308")'> 308: </pre>
<pre id='line308' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line309")'> 309:             # shift states circular</pre>
<pre id='line309' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line310")'> 310:             shift3_real(&amp;phi0, &amp;phi1, &amp;phi2)</pre>
<pre id='line310' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":310
 * 
 *             # shift states circular
 *             shift3_real(&phi0, &phi1, &phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if limit % 2 == 1:
 */
      __pyx_f_3kpm_3mom_shift3_real((&__pyx_v_phi0), (&__pyx_v_phi1), (&__pyx_v_phi2));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line311")'> 311: </pre>
<pre id='line311' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line312")'> 312:         if limit % 2 == 1:</pre>
<pre id='line312' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":312
 *             shift3_real(&phi0, &phi1, &phi2)
 * 
 *         if limit % 2 == 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 */
    __pyx_t_12 = ((__pyx_v_limit % 2) == 1);
    if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line313")'> 313:             # calculate last Chebychev moment in case of an odd truncation</pre>
<pre id='line313' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line314")'> 314:             # number</pre>
<pre id='line314' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line315")'> 315:             mom[limit-1] = 2*dot_real_omp(phi1, phi1, rank)-mom[0]</pre>
<pre id='line315' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":315
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 *             mom[limit-1] = 2*dot_real_omp(phi1, phi1, rank)-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     finally:
 */
      (__pyx_v_mom[(__pyx_v_limit - 1)]) = ((2.0 * __pyx_f_3kpm_3mom_dot_real_omp(__pyx_v_phi1, __pyx_v_phi1, __pyx_v_rank)) - (__pyx_v_mom[0]));
      goto __pyx_L41;
    }
    __pyx_L41:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line316")'> 316: </pre>
<pre id='line316' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line317")'> 317:     finally:</pre>
<pre id='line317' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line318")'> 318:         # clean up memory</pre>
<pre id='line318' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line319")'> 319:         libc.stdlib.free(phi0)</pre>
<pre id='line319' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":319
 *     finally:
 *         # clean up memory
 *         libc.stdlib.free(phi0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)
 */
  /*finally:*/ {
    free(__pyx_v_phi0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line320")'> 320:         libc.stdlib.free(phi1)</pre>
<pre id='line320' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":320
 *         # clean up memory
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi2)
 * 
 */
    free(__pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line321")'> 321:         libc.stdlib.free(phi2)</pre>
<pre id='line321' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":321
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # return
 */
    free(__pyx_v_phi2);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line322")'> 322: </pre>
<pre id='line322' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line323")'> 323:     # return</pre>
<pre id='line323' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line324")'> 324:     return &lt;object&gt;out if do_return else None</pre>
<pre id='line324' class='code' style='background-color: #FFFF2b'>
  /* "kpm/mom.pyx":324
 * 
 *     # return
 *     return <code><</code>object>out if do_return else None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_do_return);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (__pyx_t_12) {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = ((PyObject *)__pyx_v_out);
  } else {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    __pyx_t_5 = Py_None;
  }
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_real_omp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___modified__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_do_return);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line325")'> 325: </pre>
<pre id='line325' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line326")'> 326: </pre>
<pre id='line326' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line327")'> 327: @cython.cdivision(True)</pre>
<pre id='line327' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line328")'> 328: @cython.boundscheck(False)</pre>
<pre id='line328' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line329")'> 329: def _expec_csr_complex(numpy.ndarray[int, mode="c"] indices,</pre>
<pre id='line329' class='code' style='background-color: #FFFF8d'>
/* "kpm/mom.pyx":329
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_complex(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                        numpy.ndarray[int, mode="c"] indptr,
 *                        numpy.ndarray[complex, mode="c"] data,
 */

static PyObject *__pyx_pf_3kpm_3mom_5_expec_csr_complex(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3kpm_3mom_5_expec_csr_complex[] = "_expec_csr_complex(numpy.ndarray[int, mode=\"c\"]     indices,\n                        numpy.ndarray[int, mode=\"c\"]     indptr,\n                        numpy.ndarray[complex, mode=\"c\"] data,\n                        numpy.ndarray[complex, mode=\"c\"] state,\n                        int                              limit,\n                        numpy.ndarray[complex, mode=\"c\"] out=None)\n\n    Calculate complex Chebychev moments for expectation values of the form\n    <code><</code>a|T_n(H)|a> for a complex state vector |a> \"state\" and a complex CSR\n    matrix H, defined by column indices \"indices\", row pointer \"indptr\" and\n    complex non-zero values \"data\". Specify required number of moments \"limit\"\n    (truncation limit). If \"out\" is not None, store the results in \"out\"\n    instead of returning them.\n\n    ";
static PyMethodDef __pyx_mdef_3kpm_3mom_5_expec_csr_complex = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("_expec_csr_complex"), (PyCFunction)__pyx_pf_3kpm_3mom_5_expec_csr_complex, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3kpm_3mom_5_expec_csr_complex)};
static PyObject *__pyx_pf_3kpm_3mom_5_expec_csr_complex(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_indices = 0;
  PyArrayObject *__pyx_v_indptr = 0;
  PyArrayObject *__pyx_v_data = 0;
  PyArrayObject *__pyx_v_state = 0;
  int __pyx_v_limit;
  PyArrayObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_v___modified__ = NULL;
  int __pyx_v_rank;
  PyObject *__pyx_v_do_return = NULL;
  int *__pyx_v_ind;
  int *__pyx_v_ptr;
  __pyx_t_double_complex *__pyx_v_dat;
  __pyx_t_double_complex *__pyx_v_mom;
  __pyx_t_double_complex *__pyx_v_sta;
  __pyx_t_double_complex *__pyx_v_phi0;
  __pyx_t_double_complex *__pyx_v_phi1;
  __pyx_t_double_complex *__pyx_v_phi2;
  __pyx_t_double_complex __pyx_v_m0;
  __pyx_t_double_complex __pyx_v_m1;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  Py_buffer __pyx_bstruct_out;
  Py_ssize_t __pyx_bstride_0_out = 0;
  Py_ssize_t __pyx_bshape_0_out = 0;
  Py_buffer __pyx_bstruct_state;
  Py_ssize_t __pyx_bstride_0_state = 0;
  Py_ssize_t __pyx_bshape_0_state = 0;
  Py_buffer __pyx_bstruct_data;
  Py_ssize_t __pyx_bstride_0_data = 0;
  Py_ssize_t __pyx_bshape_0_data = 0;
  Py_buffer __pyx_bstruct_indptr;
  Py_ssize_t __pyx_bstride_0_indptr = 0;
  Py_ssize_t __pyx_bshape_0_indptr = 0;
  Py_buffer __pyx_bstruct_indices;
  Py_ssize_t __pyx_bstride_0_indices = 0;
  Py_ssize_t __pyx_bshape_0_indices = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__indptr,&__pyx_n_s__data,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_expec_csr_complex");
  __pyx_self = __pyx_self;
  {
    PyObject* values[6] = {0,0,0,0,0,0};

  /* "kpm/mom.pyx":329
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_complex(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                        numpy.ndarray[int, mode="c"] indptr,
 *                        numpy.ndarray[complex, mode="c"] data,
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_5_expec_csr_complex, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s___expec_csr_complex, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line330")'> 330:                        numpy.ndarray[int, mode="c"] indptr,</pre>
<pre id='line330' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line331")'> 331:                        numpy.ndarray[complex, mode="c"] data,</pre>
<pre id='line331' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line332")'> 332:                        numpy.ndarray[complex, mode="c"] state,</pre>
<pre id='line332' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line333")'> 333:                        int limit, numpy.ndarray[complex, mode="c"] out=None):</pre>
<pre id='line333' class='code' style='background-color: #FFFF16'>
    /* "kpm/mom.pyx":333
 *                        numpy.ndarray[complex, mode="c"] data,
 *                        numpy.ndarray[complex, mode="c"] state,
 *                        int limit, numpy.ndarray[complex, mode="c"] out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """_expec_csr_complex(numpy.ndarray[int, mode="c"]     indices,
 *                         numpy.ndarray[int, mode="c"]     indptr,
 */
    values[5] = (PyObject *)((PyArrayObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indptr);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex", 0, 5, 6, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex", 0, 5, 6, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex", 0, 5, 6, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[4])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex", 0, 5, 6, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "_expec_csr_complex") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = ((PyArrayObject *)values[0]);
    __pyx_v_indptr = ((PyArrayObject *)values[1]);
    __pyx_v_data = ((PyArrayObject *)values[2]);
    __pyx_v_state = ((PyArrayObject *)values[3]);
    __pyx_v_limit = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_limit == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_out = ((PyArrayObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_complex", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_out);
  __pyx_bstruct_indices.buf = NULL;
  __pyx_bstruct_indptr.buf = NULL;
  __pyx_bstruct_data.buf = NULL;
  __pyx_bstruct_state.buf = NULL;
  __pyx_bstruct_out.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indices), __pyx_ptype_5numpy_ndarray, 1, "indices", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indptr), __pyx_ptype_5numpy_ndarray, 1, "indptr", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 330; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 331; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_state), __pyx_ptype_5numpy_ndarray, 1, "state", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 332; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_out), __pyx_ptype_5numpy_ndarray, 1, "out", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 333; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
  __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
  __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
  __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
  __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
  __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line334")'> 334:     """_expec_csr_complex(numpy.ndarray[int, mode="c"]     indices,</pre>
<pre id='line334' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line335")'> 335:                         numpy.ndarray[int, mode="c"]     indptr,</pre>
<pre id='line335' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line336")'> 336:                         numpy.ndarray[complex, mode="c"] data,</pre>
<pre id='line336' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line337")'> 337:                         numpy.ndarray[complex, mode="c"] state,</pre>
<pre id='line337' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line338")'> 338:                         int                              limit,</pre>
<pre id='line338' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line339")'> 339:                         numpy.ndarray[complex, mode="c"] out=None)</pre>
<pre id='line339' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line340")'> 340: </pre>
<pre id='line340' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line341")'> 341:     Calculate complex Chebychev moments for expectation values of the form</pre>
<pre id='line341' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line342")'> 342:     &lt;a|T_n(H)|a&gt; for a complex state vector |a&gt; "state" and a complex CSR</pre>
<pre id='line342' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line343")'> 343:     matrix H, defined by column indices "indices", row pointer "indptr" and</pre>
<pre id='line343' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line344")'> 344:     complex non-zero values "data". Specify required number of moments "limit"</pre>
<pre id='line344' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line345")'> 345:     (truncation limit). If "out" is not None, store the results in "out"</pre>
<pre id='line345' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line346")'> 346:     instead of returning them.</pre>
<pre id='line346' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line347")'> 347: </pre>
<pre id='line347' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line348")'> 348:     """</pre>
<pre id='line348' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line349")'> 349:     __created__ = '2012-08-19'</pre>
<pre id='line349' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":349
 * 
 *     """
 *     __created__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __modified__ = '2012-09-05'
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line350")'> 350:     __modified__ = '2012-09-05'</pre>
<pre id='line350' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":350
 *     """
 *     __created__ = '2012-08-19'
 *     __modified__ = '2012-09-05'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # prepare
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
  __pyx_v___modified__ = ((PyObject *)__pyx_kp_s_17);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line351")'> 351: </pre>
<pre id='line351' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line352")'> 352:     # prepare</pre>
<pre id='line352' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line353")'> 353:     cdef int rank = len(indptr)-1</pre>
<pre id='line353' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":353
 * 
 *     # prepare
 *     cdef int rank = len(indptr)-1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_indptr));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_rank = (__pyx_t_1 - 1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line354")'> 354:     if len(state) != rank:</pre>
<pre id='line354' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":354
 *     # prepare
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_state));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = (__pyx_t_1 != __pyx_v_rank);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line355")'> 355:         raise ValueError('bad state, must be equal to the rank of the matrix')</pre>
<pre id='line355' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":355
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_24), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "kpm/mom.pyx":355
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
  __pyx_k_tuple_24 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_24));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_18));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_24, 0, ((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_24));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line356")'> 356:     if limit &lt; 1:</pre>
<pre id='line356' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":356
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 */
  __pyx_t_2 = (__pyx_v_limit <code><</code> 1);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line357")'> 357:         raise ValueError('bad truncation limit, expecting positive integer')</pre>
<pre id='line357' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":357
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_25), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "kpm/mom.pyx":357
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
  __pyx_k_tuple_25 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 357; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_25));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_25, 0, ((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_25));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line358")'> 358:     do_return = out is None</pre>
<pre id='line358' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":358
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if out is None:
 *         out = numpy.empty(limit, dtype=complex)
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 358; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_v_do_return = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line359")'> 359:     if out is None:</pre>
<pre id='line359' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":359
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 *     if out is None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.empty(limit, dtype=complex)
 *     if not out.flags['C_CONTIGUOUS']:
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line360")'> 360:         out = numpy.empty(limit, dtype=complex)</pre>
<pre id='line360' class='code' style='background-color: #FFFF25'>
    /* "kpm/mom.pyx":360
 *     do_return = out is None
 *     if out is None:
 *         out = numpy.empty(limit, dtype=complex)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_limit);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyComplex_Type)))) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 360; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line361")'> 361:     if not out.flags['C_CONTIGUOUS']:</pre>
<pre id='line361' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":361
 *     if out is None:
 *         out = numpy.empty(limit, dtype=complex)
 *     if not out.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_out), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line362")'> 362:         out = numpy.ascontiguousarray(out)</pre>
<pre id='line362' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":362
 *         out = numpy.empty(limit, dtype=complex)
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_out));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 362; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L9;
  }
  __pyx_L9:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line363")'> 363:     if not indices.flags['C_CONTIGUOUS']:</pre>
<pre id='line363' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":363
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indices), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 363; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line364")'> 364:         indices = numpy.ascontiguousarray(indices)</pre>
<pre id='line364' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":364
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indices));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indices));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indices));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
      __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indices));
    __pyx_v_indices = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line365")'> 365:     if not indptr.flags['C_CONTIGUOUS']:</pre>
<pre id='line365' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":365
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indptr), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 365; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line366")'> 366:         indptr = numpy.ascontiguousarray(indptr)</pre>
<pre id='line366' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":366
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indptr));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indptr));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indptr));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_14 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
      __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 366; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_14 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indptr));
    __pyx_v_indptr = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L11;
  }
  __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line367")'> 367:     if not data.flags['C_CONTIGUOUS']:</pre>
<pre id='line367' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":367
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_data), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line368")'> 368:         data = numpy.ascontiguousarray(data)</pre>
<pre id='line368' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":368
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_data));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_data));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_15 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
      __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 368; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_data));
    __pyx_v_data = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L12;
  }
  __pyx_L12:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line369")'> 369:     if not state.flags['C_CONTIGUOUS']:</pre>
<pre id='line369' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":369
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         state = numpy.ascontiguousarray(state)
 * 
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_state), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line370")'> 370:         state = numpy.ascontiguousarray(state)</pre>
<pre id='line370' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":370
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # calculate
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_state));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_state));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_state));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_16 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_t_16, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
      __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 370; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_state));
    __pyx_v_state = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L13;
  }
  __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line371")'> 371: </pre>
<pre id='line371' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line372")'> 372:     # calculate</pre>
<pre id='line372' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line373")'> 373:     cdef:</pre>
<pre id='line373' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line374")'> 374:         int *ind = &lt;int*&gt;indices.data</pre>
<pre id='line374' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":374
 *     # calculate
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int *ptr = <code><</code>int*>indptr.data
 *         complex *dat = <code><</code>complex*>data.data
 */
  __pyx_v_ind = ((int *)__pyx_v_indices->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line375")'> 375:         int *ptr = &lt;int*&gt;indptr.data</pre>
<pre id='line375' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":375
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *dat = <code><</code>complex*>data.data
 *         complex *mom = <code><</code>complex*>out.data
 */
  __pyx_v_ptr = ((int *)__pyx_v_indptr->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line376")'> 376:         complex *dat = &lt;complex*&gt;data.data</pre>
<pre id='line376' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":376
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data
 *         complex *dat = <code><</code>complex*>data.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *mom = <code><</code>complex*>out.data
 *         complex *sta = <code><</code>complex*>state.data
 */
  __pyx_v_dat = ((__pyx_t_double_complex *)__pyx_v_data->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line377")'> 377:         complex *mom = &lt;complex*&gt;out.data</pre>
<pre id='line377' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":377
 *         int *ptr = <code><</code>int*>indptr.data
 *         complex *dat = <code><</code>complex*>data.data
 *         complex *mom = <code><</code>complex*>out.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *sta = <code><</code>complex*>state.data
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 */
  __pyx_v_mom = ((__pyx_t_double_complex *)__pyx_v_out->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line378")'> 378:         complex *sta = &lt;complex*&gt;state.data</pre>
<pre id='line378' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":378
 *         complex *dat = <code><</code>complex*>data.data
 *         complex *mom = <code><</code>complex*>out.data
 *         complex *sta = <code><</code>complex*>state.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 */
  __pyx_v_sta = ((__pyx_t_double_complex *)__pyx_v_state->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line379")'> 379:         complex *phi0 = &lt;complex*&gt;libc.stdlib.malloc(sizeof(complex)*rank)</pre>
<pre id='line379' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":379
 *         complex *mom = <code><</code>complex*>out.data
 *         complex *sta = <code><</code>complex*>state.data
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi2 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 */
  __pyx_v_phi0 = ((__pyx_t_double_complex *)malloc(((sizeof(__pyx_t_double_complex)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line380")'> 380:         complex *phi1 = &lt;complex*&gt;libc.stdlib.malloc(sizeof(complex)*rank)</pre>
<pre id='line380' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":380
 *         complex *sta = <code><</code>complex*>state.data
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *phi2 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex m0, m1  # temporary reduction variables
 */
  __pyx_v_phi1 = ((__pyx_t_double_complex *)malloc(((sizeof(__pyx_t_double_complex)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line381")'> 381:         complex *phi2 = &lt;complex*&gt;libc.stdlib.malloc(sizeof(complex)*rank)</pre>
<pre id='line381' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":381
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi2 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex m0, m1  # temporary reduction variables
 *         int     i, j, k
 */
  __pyx_v_phi2 = ((__pyx_t_double_complex *)malloc(((sizeof(__pyx_t_double_complex)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line382")'> 382:         complex m0, m1  # temporary reduction variables</pre>
<pre id='line382' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line383")'> 383:         int     i, j, k</pre>
<pre id='line383' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line384")'> 384:     try:</pre>
<pre id='line384' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":384
 *         complex m0, m1  # temporary reduction variables
 *         int     i, j, k
 *     try:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # calculate first two orders of the Chebychev expansion
 *         for k in range(rank):
 */
  /*try:*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line385")'> 385:         # calculate first two orders of the Chebychev expansion</pre>
<pre id='line385' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line386")'> 386:         for k in range(rank):</pre>
<pre id='line386' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":386
 *     try:
 *         # calculate first two orders of the Chebychev expansion
 *         for k in range(rank):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex(phi0, phi0, rank)
 */
    __pyx_t_8 = __pyx_v_rank;
    for (__pyx_t_17 = 0; __pyx_t_17 <code><</code> __pyx_t_8; __pyx_t_17+=1) {
      __pyx_v_k = __pyx_t_17;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line387")'> 387:             phi0[k] = sta[k]</pre>
<pre id='line387' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":387
 *         # calculate first two orders of the Chebychev expansion
 *         for k in range(rank):
 *             phi0[k] = sta[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[0] = dot_complex(phi0, phi0, rank)
 *         matvec_csr_complex(ind, ptr, dat, rank, phi0, phi1)
 */
      (__pyx_v_phi0[__pyx_v_k]) = (__pyx_v_sta[__pyx_v_k]);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line388")'> 388:         mom[0] = dot_complex(phi0, phi0, rank)</pre>
<pre id='line388' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":388
 *         for k in range(rank):
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex(phi0, phi0, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         matvec_csr_complex(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_complex(phi0, phi1, rank)
 */
    (__pyx_v_mom[0]) = __pyx_f_3kpm_3mom_dot_complex(__pyx_v_phi0, __pyx_v_phi0, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line389")'> 389:         matvec_csr_complex(ind, ptr, dat, rank, phi0, phi1)</pre>
<pre id='line389' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":389
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex(phi0, phi0, rank)
 *         matvec_csr_complex(ind, ptr, dat, rank, phi0, phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[1] = dot_complex(phi0, phi1, rank)
 * 
 */
    __pyx_f_3kpm_3mom_matvec_csr_complex(__pyx_v_ind, __pyx_v_ptr, __pyx_v_dat, __pyx_v_rank, __pyx_v_phi0, __pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line390")'> 390:         mom[1] = dot_complex(phi0, phi1, rank)</pre>
<pre id='line390' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":390
 *         mom[0] = dot_complex(phi0, phi0, rank)
 *         matvec_csr_complex(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_complex(phi0, phi1, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # main iteration loop
 */
    (__pyx_v_mom[1]) = __pyx_f_3kpm_3mom_dot_complex(__pyx_v_phi0, __pyx_v_phi1, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line391")'> 391: </pre>
<pre id='line391' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line392")'> 392:         # main iteration loop</pre>
<pre id='line392' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line393")'> 393:         for i in range(1, limit/2):</pre>
<pre id='line393' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":393
 * 
 *         # main iteration loop
 *         for i in range(1, limit/2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # initialize temporary reduction variables
 *             m0 = 0
 */
    __pyx_t_18 = (__pyx_v_limit / 2);
    for (__pyx_t_8 = 1; __pyx_t_8 <code><</code> __pyx_t_18; __pyx_t_8+=1) {
      __pyx_v_i = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line394")'> 394:             # initialize temporary reduction variables</pre>
<pre id='line394' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line395")'> 395:             m0 = 0</pre>
<pre id='line395' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":395
 *         for i in range(1, limit/2):
 *             # initialize temporary reduction variables
 *             m0 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             m1 = 0
 * 
 */
      __pyx_v_m0 = __pyx_t_double_complex_from_parts(0, 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line396")'> 396:             m1 = 0</pre>
<pre id='line396' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":396
 *             # initialize temporary reduction variables
 *             m0 = 0
 *             m1 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for k in range(rank):
 */
      __pyx_v_m1 = __pyx_t_double_complex_from_parts(0, 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line397")'> 397: </pre>
<pre id='line397' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line398")'> 398:             for k in range(rank):</pre>
<pre id='line398' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":398
 *             m1 = 0
 * 
 *             for k in range(rank):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 */
      __pyx_t_17 = __pyx_v_rank;
      for (__pyx_t_19 = 0; __pyx_t_19 <code><</code> __pyx_t_17; __pyx_t_19+=1) {
        __pyx_v_k = __pyx_t_19;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line399")'> 399:                 # CSR-matrix-vector multiplication</pre>
<pre id='line399' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line400")'> 400:                 phi2[k] = 0</pre>
<pre id='line400' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":400
 *             for k in range(rank):
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 */
        (__pyx_v_phi2[__pyx_v_k]) = __pyx_t_double_complex_from_parts(0, 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line401")'> 401:                 for j in range(ptr[k], ptr[k+1]):</pre>
<pre id='line401' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":401
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]
 */
        __pyx_t_20 = (__pyx_v_ptr[(__pyx_v_k + 1)]);
        for (__pyx_t_21 = (__pyx_v_ptr[__pyx_v_k]); __pyx_t_21 <code><</code> __pyx_t_20; __pyx_t_21+=1) {
          __pyx_v_j = __pyx_t_21;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line402")'> 402:                     phi2[k] += 2*dat[j]*phi1[ind[j]]</pre>
<pre id='line402' class='code' style='background-color: #FFFFff'>
          /* "kpm/mom.pyx":402
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 phi2[k] -= phi0[k]
 * 
 */
          __pyx_t_22 = __pyx_v_k;
          (__pyx_v_phi2[__pyx_t_22]) = __Pyx_c_sum((__pyx_v_phi2[__pyx_t_22]), __Pyx_c_prod(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), (__pyx_v_dat[__pyx_v_j])), (__pyx_v_phi1[(__pyx_v_ind[__pyx_v_j])])));
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line403")'> 403:                 phi2[k] -= phi0[k]</pre>
<pre id='line403' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":403
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # calculate Chebychev moments, part 1
 */
        __pyx_t_20 = __pyx_v_k;
        (__pyx_v_phi2[__pyx_t_20]) = __Pyx_c_diff((__pyx_v_phi2[__pyx_t_20]), (__pyx_v_phi0[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line404")'> 404: </pre>
<pre id='line404' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line405")'> 405:                 # calculate Chebychev moments, part 1</pre>
<pre id='line405' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line406")'> 406:                 # use temporary reduction variables so that Cython/OpenMP</pre>
<pre id='line406' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line407")'> 407:                 # understands</pre>
<pre id='line407' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line408")'> 408:                 m0 += 2*phi1[k].conjugate()*phi1[k]  # reduction for mom[i*2]</pre>
<pre id='line408' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":408
 *                 # use temporary reduction variables so that Cython/OpenMP
 *                 # understands
 *                 m0 += 2*phi1[k].conjugate()*phi1[k]  # reduction for mom[i*2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 m1 += 2*phi2[k].conjugate()*phi1[k]  # reduction for mom[i*2+1]
 * 
 */
        __pyx_v_m0 = __Pyx_c_sum(__pyx_v_m0, __Pyx_c_prod(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), __Pyx_c_conj((__pyx_v_phi1[__pyx_v_k]))), (__pyx_v_phi1[__pyx_v_k])));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line409")'> 409:                 m1 += 2*phi2[k].conjugate()*phi1[k]  # reduction for mom[i*2+1]</pre>
<pre id='line409' class='code' style='background-color: #FFFFff'>
        /* "kpm/mom.pyx":409
 *                 # understands
 *                 m0 += 2*phi1[k].conjugate()*phi1[k]  # reduction for mom[i*2]
 *                 m1 += 2*phi2[k].conjugate()*phi1[k]  # reduction for mom[i*2+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # calculate Chebychev moments, part 2
 */
        __pyx_v_m1 = __Pyx_c_sum(__pyx_v_m1, __Pyx_c_prod(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), __Pyx_c_conj((__pyx_v_phi2[__pyx_v_k]))), (__pyx_v_phi1[__pyx_v_k])));
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line410")'> 410: </pre>
<pre id='line410' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line411")'> 411:             # calculate Chebychev moments, part 2</pre>
<pre id='line411' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line412")'> 412:             mom[i*2] = m0-mom[0]</pre>
<pre id='line412' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":412
 * 
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = m0-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             mom[i*2+1] = m1-mom[1]
 * 
 */
      (__pyx_v_mom[(__pyx_v_i * 2)]) = __Pyx_c_diff(__pyx_v_m0, (__pyx_v_mom[0]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line413")'> 413:             mom[i*2+1] = m1-mom[1]</pre>
<pre id='line413' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":413
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = m0-mom[0]
 *             mom[i*2+1] = m1-mom[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # shift states circular
 */
      (__pyx_v_mom[((__pyx_v_i * 2) + 1)]) = __Pyx_c_diff(__pyx_v_m1, (__pyx_v_mom[1]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line414")'> 414: </pre>
<pre id='line414' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line415")'> 415:             # shift states circular</pre>
<pre id='line415' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line416")'> 416:             shift3_complex(&amp;phi0, &amp;phi1, &amp;phi2)</pre>
<pre id='line416' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":416
 * 
 *             # shift states circular
 *             shift3_complex(&phi0, &phi1, &phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if limit % 2 == 1:
 */
      __pyx_f_3kpm_3mom_shift3_complex((&__pyx_v_phi0), (&__pyx_v_phi1), (&__pyx_v_phi2));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line417")'> 417: </pre>
<pre id='line417' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line418")'> 418:         if limit % 2 == 1:</pre>
<pre id='line418' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":418
 *             shift3_complex(&phi0, &phi1, &phi2)
 * 
 *         if limit % 2 == 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 */
    __pyx_t_12 = ((__pyx_v_limit % 2) == 1);
    if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line419")'> 419:             # calculate last Chebychev moment in case of an odd truncation</pre>
<pre id='line419' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line420")'> 420:             # number</pre>
<pre id='line420' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line421")'> 421:             mom[limit-1] = 2*dot_complex(phi1, phi1, rank)-mom[0]</pre>
<pre id='line421' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":421
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 *             mom[limit-1] = 2*dot_complex(phi1, phi1, rank)-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     finally:
 */
      (__pyx_v_mom[(__pyx_v_limit - 1)]) = __Pyx_c_diff(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), __pyx_f_3kpm_3mom_dot_complex(__pyx_v_phi1, __pyx_v_phi1, __pyx_v_rank)), (__pyx_v_mom[0]));
      goto __pyx_L25;
    }
    __pyx_L25:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line422")'> 422: </pre>
<pre id='line422' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line423")'> 423:     finally:</pre>
<pre id='line423' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line424")'> 424:         # clean up memory</pre>
<pre id='line424' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line425")'> 425:         libc.stdlib.free(phi0)</pre>
<pre id='line425' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":425
 *     finally:
 *         # clean up memory
 *         libc.stdlib.free(phi0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)
 */
  /*finally:*/ {
    free(__pyx_v_phi0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line426")'> 426:         libc.stdlib.free(phi1)</pre>
<pre id='line426' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":426
 *         # clean up memory
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi2)
 * 
 */
    free(__pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line427")'> 427:         libc.stdlib.free(phi2)</pre>
<pre id='line427' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":427
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # return
 */
    free(__pyx_v_phi2);
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line428")'> 428: </pre>
<pre id='line428' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line429")'> 429:     # return</pre>
<pre id='line429' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line430")'> 430:     return &lt;object&gt;out if do_return else None</pre>
<pre id='line430' class='code' style='background-color: #FFFF2b'>
  /* "kpm/mom.pyx":430
 * 
 *     # return
 *     return <code><</code>object>out if do_return else None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_do_return);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 430; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (__pyx_t_12) {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = ((PyObject *)__pyx_v_out);
  } else {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    __pyx_t_5 = Py_None;
  }
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_complex", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___modified__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_do_return);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line431")'> 431: </pre>
<pre id='line431' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line432")'> 432: </pre>
<pre id='line432' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line433")'> 433: @cython.cdivision(True)</pre>
<pre id='line433' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line434")'> 434: @cython.boundscheck(False)</pre>
<pre id='line434' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF8d' onclick='toggleDiv("line435")'> 435: def _expec_csr_complex_omp(numpy.ndarray[int, mode="c"] indices,</pre>
<pre id='line435' class='code' style='background-color: #FFFF8d'>
/* "kpm/mom.pyx":435
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_complex_omp(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                            numpy.ndarray[int, mode="c"] indptr,
 *                            numpy.ndarray[complex, mode="c"] data,
 */

static PyObject *__pyx_pf_3kpm_3mom_6_expec_csr_complex_omp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3kpm_3mom_6_expec_csr_complex_omp[] = "_expec_csr_complex_omp(numpy.ndarray[int, mode=\"c\"]     indices,\n                            numpy.ndarray[int, mode=\"c\"]     indptr,\n                            numpy.ndarray[complex, mode=\"c\"] data,\n                            numpy.ndarray[complex, mode=\"c\"] state,\n                            int                              limit,\n                            numpy.ndarray[complex, mode=\"c\"] out=None)\n\n    Calculate complex Chebychev moments for expectation values of the form\n    <code><</code>a|T_n(H)|a> for a complex state vector |a> \"state\" and a complex CSR\n    matrix H, defined by column indices \"indices\", row pointer \"indptr\" and\n    complex non-zero values \"data\". Specify required number of moments \"limit\"\n    (truncation limit). If \"out\" is not None, store the results in \"out\"\n    instead of returning them.\n\n    This is the OpenMP version of the function, using parallel for-loops.";
static PyMethodDef __pyx_mdef_3kpm_3mom_6_expec_csr_complex_omp = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("_expec_csr_complex_omp"), (PyCFunction)__pyx_pf_3kpm_3mom_6_expec_csr_complex_omp, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3kpm_3mom_6_expec_csr_complex_omp)};
static PyObject *__pyx_pf_3kpm_3mom_6_expec_csr_complex_omp(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_indices = 0;
  PyArrayObject *__pyx_v_indptr = 0;
  PyArrayObject *__pyx_v_data = 0;
  PyArrayObject *__pyx_v_state = 0;
  int __pyx_v_limit;
  PyArrayObject *__pyx_v_out = 0;
  PyObject *__pyx_v___created__ = NULL;
  PyObject *__pyx_v___modified__ = NULL;
  int __pyx_v_rank;
  PyObject *__pyx_v_do_return = NULL;
  int *__pyx_v_ind;
  int *__pyx_v_ptr;
  __pyx_t_double_complex *__pyx_v_dat;
  __pyx_t_double_complex *__pyx_v_mom;
  __pyx_t_double_complex *__pyx_v_sta;
  __pyx_t_double_complex *__pyx_v_phi0;
  __pyx_t_double_complex *__pyx_v_phi1;
  __pyx_t_double_complex *__pyx_v_phi2;
  double __pyx_v_re0;
  double __pyx_v_im0;
  double __pyx_v_re1;
  double __pyx_v_im1;
  __pyx_t_double_complex __pyx_v_m0;
  __pyx_t_double_complex __pyx_v_m1;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  Py_buffer __pyx_bstruct_out;
  Py_ssize_t __pyx_bstride_0_out = 0;
  Py_ssize_t __pyx_bshape_0_out = 0;
  Py_buffer __pyx_bstruct_indptr;
  Py_ssize_t __pyx_bstride_0_indptr = 0;
  Py_ssize_t __pyx_bshape_0_indptr = 0;
  Py_buffer __pyx_bstruct_state;
  Py_ssize_t __pyx_bstride_0_state = 0;
  Py_ssize_t __pyx_bshape_0_state = 0;
  Py_buffer __pyx_bstruct_data;
  Py_ssize_t __pyx_bstride_0_data = 0;
  Py_ssize_t __pyx_bshape_0_data = 0;
  Py_buffer __pyx_bstruct_indices;
  Py_ssize_t __pyx_bstride_0_indices = 0;
  Py_ssize_t __pyx_bshape_0_indices = 0;
  PyObject *__pyx_r = NULL;
  static PyObject **__pyx_pyargnames[] = {&__pyx_n_s__indices,&__pyx_n_s__indptr,&__pyx_n_s__data,&__pyx_n_s__state,&__pyx_n_s__limit,&__pyx_n_s__out,0};
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("_expec_csr_complex_omp");
  __pyx_self = __pyx_self;
  {
    PyObject* values[6] = {0,0,0,0,0,0};

  /* "kpm/mom.pyx":435
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * def _expec_csr_complex_omp(numpy.ndarray[int, mode="c"] indices,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                            numpy.ndarray[int, mode="c"] indptr,
 *                            numpy.ndarray[complex, mode="c"] data,
 */
  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_3kpm_3mom_6_expec_csr_complex_omp, NULL, __pyx_n_s_43);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_1);
  if (<span class='py_c_api'>PyObject_SetAttr</span>(__pyx_m, __pyx_n_s_10, __pyx_t_1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line436")'> 436:                            numpy.ndarray[int, mode="c"] indptr,</pre>
<pre id='line436' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line437")'> 437:                            numpy.ndarray[complex, mode="c"] data,</pre>
<pre id='line437' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line438")'> 438:                            numpy.ndarray[complex, mode="c"] state,</pre>
<pre id='line438' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line439")'> 439:                            int limit,</pre>
<pre id='line439' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF16' onclick='toggleDiv("line440")'> 440:                            numpy.ndarray[complex, mode="c"] out=None):</pre>
<pre id='line440' class='code' style='background-color: #FFFF16'>
    /* "kpm/mom.pyx":440
 *                            numpy.ndarray[complex, mode="c"] state,
 *                            int limit,
 *                            numpy.ndarray[complex, mode="c"] out=None):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """_expec_csr_complex_omp(numpy.ndarray[int, mode="c"]     indices,
 *                             numpy.ndarray[int, mode="c"]     indptr,
 */
    values[5] = (PyObject *)((PyArrayObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  0:
        values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indices);
        if (likely(values[0])) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__indptr);
        if (likely(values[1])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex_omp", 0, 5, 6, 1);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__data);
        if (likely(values[2])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex_omp", 0, 5, 6, 2);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__state);
        if (likely(values[3])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex_omp", 0, 5, 6, 3);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  4:
        values[4] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__limit);
        if (likely(values[4])) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex_omp", 0, 5, 6, 4);<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  5:
        if (kw_args > 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s__out);
          if (value) { values[5] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args > 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args), "_expec_csr_complex_omp") <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_indices = ((PyArrayObject *)values[0]);
    __pyx_v_indptr = ((PyArrayObject *)values[1]);
    __pyx_v_data = ((PyArrayObject *)values[2]);
    __pyx_v_state = ((PyArrayObject *)values[3]);
    __pyx_v_limit = __Pyx_<span class='py_c_api'>PyInt_AsInt</span>(values[4]);<span class='error_goto'> if (unlikely((__pyx_v_limit == (int)-1) && <span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 439; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_out = ((PyArrayObject *)values[5]);
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("_expec_csr_complex_omp", 0, 5, 6, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_complex_omp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_v_out);
  __pyx_bstruct_indices.buf = NULL;
  __pyx_bstruct_indptr.buf = NULL;
  __pyx_bstruct_data.buf = NULL;
  __pyx_bstruct_state.buf = NULL;
  __pyx_bstruct_out.buf = NULL;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indices), __pyx_ptype_5numpy_ndarray, 1, "indices", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_indptr), __pyx_ptype_5numpy_ndarray, 1, "indptr", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 436; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_data), __pyx_ptype_5numpy_ndarray, 1, "data", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 437; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_state), __pyx_ptype_5numpy_ndarray, 1, "state", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 438; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_out), __pyx_ptype_5numpy_ndarray, 1, "out", 0)))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 440; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
  __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
  __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
  __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
  __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 435; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
  __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line441")'> 441:     """_expec_csr_complex_omp(numpy.ndarray[int, mode="c"]     indices,</pre>
<pre id='line441' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line442")'> 442:                             numpy.ndarray[int, mode="c"]     indptr,</pre>
<pre id='line442' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line443")'> 443:                             numpy.ndarray[complex, mode="c"] data,</pre>
<pre id='line443' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line444")'> 444:                             numpy.ndarray[complex, mode="c"] state,</pre>
<pre id='line444' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line445")'> 445:                             int                              limit,</pre>
<pre id='line445' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line446")'> 446:                             numpy.ndarray[complex, mode="c"] out=None)</pre>
<pre id='line446' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line447")'> 447: </pre>
<pre id='line447' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line448")'> 448:     Calculate complex Chebychev moments for expectation values of the form</pre>
<pre id='line448' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line449")'> 449:     &lt;a|T_n(H)|a&gt; for a complex state vector |a&gt; "state" and a complex CSR</pre>
<pre id='line449' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line450")'> 450:     matrix H, defined by column indices "indices", row pointer "indptr" and</pre>
<pre id='line450' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line451")'> 451:     complex non-zero values "data". Specify required number of moments "limit"</pre>
<pre id='line451' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line452")'> 452:     (truncation limit). If "out" is not None, store the results in "out"</pre>
<pre id='line452' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line453")'> 453:     instead of returning them.</pre>
<pre id='line453' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line454")'> 454: </pre>
<pre id='line454' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line455")'> 455:     This is the OpenMP version of the function, using parallel for-loops."""</pre>
<pre id='line455' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line456")'> 456:     __created__ = '2012-08-19'</pre>
<pre id='line456' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":456
 * 
 *     This is the OpenMP version of the function, using parallel for-loops."""
 *     __created__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     __modified__ = '2012-09-05'
 * 
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line457")'> 457:     __modified__ = '2012-09-05'</pre>
<pre id='line457' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":457
 *     This is the OpenMP version of the function, using parallel for-loops."""
 *     __created__ = '2012-08-19'
 *     __modified__ = '2012-09-05'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # prepare
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
  __pyx_v___modified__ = ((PyObject *)__pyx_kp_s_17);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line458")'> 458: </pre>
<pre id='line458' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line459")'> 459:     # prepare</pre>
<pre id='line459' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line460")'> 460:     cdef int rank = len(indptr)-1</pre>
<pre id='line460' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":460
 * 
 *     # prepare
 *     cdef int rank = len(indptr)-1             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_indptr));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 460; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_rank = (__pyx_t_1 - 1);
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line461")'> 461:     if len(state) != rank:</pre>
<pre id='line461' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":461
 *     # prepare
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 */
  __pyx_t_1 = <span class='py_c_api'>PyObject_Length</span>(((PyObject *)__pyx_v_state));<span class='error_goto'> if (unlikely(__pyx_t_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 461; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_2 = (__pyx_t_1 != __pyx_v_rank);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line462")'> 462:         raise ValueError('bad state, must be equal to the rank of the matrix')</pre>
<pre id='line462' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":462
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_26), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L6;
  }
  __pyx_L6:;

  /* "kpm/mom.pyx":462
 *     cdef int rank = len(indptr)-1
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 */
  __pyx_k_tuple_26 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 462; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_26));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_18));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_26, 0, ((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_18));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_26));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line463")'> 463:     if limit &lt; 1:</pre>
<pre id='line463' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":463
 *     if len(state) != rank:
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 */
  __pyx_t_2 = (__pyx_v_limit <code><</code> 1);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line464")'> 464:         raise ValueError('bad truncation limit, expecting positive integer')</pre>
<pre id='line464' class='code' style='background-color: #FFFF66'>
    /* "kpm/mom.pyx":464
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
    __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(__pyx_builtin_ValueError, ((PyObject *)__pyx_k_tuple_27), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
   <span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    goto __pyx_L7;
  }
  __pyx_L7:;

  /* "kpm/mom.pyx":464
 *         raise ValueError('bad state, must be equal to the rank of the matrix')
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     do_return = out is None
 *     if out is None:
 */
  __pyx_k_tuple_27 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_k_tuple_27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 464; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_k_tuple_27));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_4));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_k_tuple_27, 0, ((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_kp_s_4));
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_k_tuple_27));
</pre><pre class='line' style='background-color: #FFFFaa' onclick='toggleDiv("line465")'> 465:     do_return = out is None</pre>
<pre id='line465' class='code' style='background-color: #FFFFaa'>
  /* "kpm/mom.pyx":465
 *     if limit <code><</code> 1:
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if out is None:
 *         out = numpy.empty(limit, dtype=complex)
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  __pyx_t_3 = __Pyx_<span class='py_c_api'>PyBool_FromLong</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 465; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  __pyx_v_do_return = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line466")'> 466:     if out is None:</pre>
<pre id='line466' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":466
 *         raise ValueError('bad truncation limit, expecting positive integer')
 *     do_return = out is None
 *     if out is None:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.empty(limit, dtype=complex)
 *     if not out.flags['C_CONTIGUOUS']:
 */
  __pyx_t_2 = (((PyObject *)__pyx_v_out) == Py_None);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF25' onclick='toggleDiv("line467")'> 467:         out = numpy.empty(limit, dtype=complex)</pre>
<pre id='line467' class='code' style='background-color: #FFFF25'>
    /* "kpm/mom.pyx":467
 *     do_return = out is None
 *     if out is None:
 *         out = numpy.empty(limit, dtype=complex)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>(__pyx_v_limit);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_5));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, ((PyObject *)__pyx_n_s__dtype), ((PyObject *)((PyObject*)(&PyComplex_Type)))) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_6 = <span class='py_c_api'>PyEval_CallObjectWithKeywords</span>(__pyx_t_4, ((PyObject *)__pyx_t_5), ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_5)); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 467; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L8;
  }
  __pyx_L8:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line468")'> 468:     if not out.flags['C_CONTIGUOUS']:</pre>
<pre id='line468' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":468
 *     if out is None:
 *         out = numpy.empty(limit, dtype=complex)
 *     if not out.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_out), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 468; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line469")'> 469:         out = numpy.ascontiguousarray(out)</pre>
<pre id='line469' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":469
 *         out = numpy.empty(limit, dtype=complex)
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_out));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_7 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_t_7, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_out, (PyObject*)__pyx_v_out, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_out = __pyx_bstruct_out.strides[0];
      __pyx_bshape_0_out = __pyx_bstruct_out.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 469; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_out));
    __pyx_v_out = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L9;
  }
  __pyx_L9:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line470")'> 470:     if not indices.flags['C_CONTIGUOUS']:</pre>
<pre id='line470' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":470
 *     if not out.flags['C_CONTIGUOUS']:
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indices), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 470; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line471")'> 471:         indices = numpy.ascontiguousarray(indices)</pre>
<pre id='line471' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":471
 *         out = numpy.ascontiguousarray(out)
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indices));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indices));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indices));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_13 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_t_13, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indices, (PyObject*)__pyx_v_indices, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_indices = __pyx_bstruct_indices.strides[0];
      __pyx_bshape_0_indices = __pyx_bstruct_indices.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 471; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indices));
    __pyx_v_indices = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L10;
  }
  __pyx_L10:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line472")'> 472:     if not indptr.flags['C_CONTIGUOUS']:</pre>
<pre id='line472' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":472
 *     if not indices.flags['C_CONTIGUOUS']:
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_indptr), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 472; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line473")'> 473:         indptr = numpy.ascontiguousarray(indptr)</pre>
<pre id='line473' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":473
 *         indices = numpy.ascontiguousarray(indices)
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_indptr));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_indptr));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_indptr));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_14 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_t_14, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_indptr, (PyObject*)__pyx_v_indptr, &__Pyx_TypeInfo_int, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_indptr = __pyx_bstruct_indptr.strides[0];
      __pyx_bshape_0_indptr = __pyx_bstruct_indptr.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 473; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_14 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_indptr));
    __pyx_v_indptr = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L11;
  }
  __pyx_L11:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line474")'> 474:     if not data.flags['C_CONTIGUOUS']:</pre>
<pre id='line474' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":474
 *     if not indptr.flags['C_CONTIGUOUS']:
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 */
  __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_data), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_5, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_2 = (!__pyx_t_12);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line475")'> 475:         data = numpy.ascontiguousarray(data)</pre>
<pre id='line475' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":475
 *         indptr = numpy.ascontiguousarray(indptr)
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_data));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_data));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_data));
    __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_5, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_15 = ((PyArrayObject *)__pyx_t_6);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_t_15, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_9, &__pyx_t_10, &__pyx_t_11);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_data, (PyObject*)__pyx_v_data, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
        }
      }
      __pyx_bstride_0_data = __pyx_bstruct_data.strides[0];
      __pyx_bshape_0_data = __pyx_bstruct_data.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 475; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_data));
    __pyx_v_data = ((PyArrayObject *)__pyx_t_6);
    __pyx_t_6 = 0;
    goto __pyx_L12;
  }
  __pyx_L12:;
</pre><pre class='line' style='background-color: #FFFF5e' onclick='toggleDiv("line476")'> 476:     if not state.flags['C_CONTIGUOUS']:</pre>
<pre id='line476' class='code' style='background-color: #FFFF5e'>
  /* "kpm/mom.pyx":476
 *     if not data.flags['C_CONTIGUOUS']:
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         state = numpy.ascontiguousarray(state)
 * 
 */
  __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(((PyObject *)__pyx_v_state), __pyx_n_s__flags);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_6, ((PyObject *)__pyx_n_s__C_CONTIGUOUS));<span class='error_goto'> if (!__pyx_t_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_2 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(__pyx_t_2 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 476; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = (!__pyx_t_2);
  if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFF30' onclick='toggleDiv("line477")'> 477:         state = numpy.ascontiguousarray(state)</pre>
<pre id='line477' class='code' style='background-color: #FFFF30'>
    /* "kpm/mom.pyx":477
 *         data = numpy.ascontiguousarray(data)
 *     if not state.flags['C_CONTIGUOUS']:
 *         state = numpy.ascontiguousarray(state)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # calculate
 */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetName</span>(__pyx_m, __pyx_n_s__numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_6 = <span class='py_c_api'>PyObject_GetAttr</span>(__pyx_t_3, __pyx_n_s__ascontiguousarray);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_state));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, ((PyObject *)__pyx_v_state));
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(((PyObject *)__pyx_v_state));
    __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(__pyx_t_6, ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
    if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray)))))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    __pyx_t_16 = ((PyArrayObject *)__pyx_t_5);
    {
      __Pyx_BufFmt_StackElem __pyx_stack[1];
      <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_t_16, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack);
      if (unlikely(__pyx_t_8 <code><</code> 0)) {
        <span class='py_c_api'>PyErr_Fetch</span>(&__pyx_t_11, &__pyx_t_10, &__pyx_t_9);
        if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&__pyx_bstruct_state, (PyObject*)__pyx_v_state, &__Pyx_TypeInfo___pyx_t_double_complex, PyBUF_FORMAT| PyBUF_C_CONTIGUOUS, 1, 0, __pyx_stack) == -1)) {
          Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
          <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
        } else {
          <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
        }
      }
      __pyx_bstride_0_state = __pyx_bstruct_state.strides[0];
      __pyx_bshape_0_state = __pyx_bstruct_state.shape[0];
      if (unlikely(__pyx_t_8 <code><</code> 0))<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 477; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    }
    __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_v_state));
    __pyx_v_state = ((PyArrayObject *)__pyx_t_5);
    __pyx_t_5 = 0;
    goto __pyx_L13;
  }
  __pyx_L13:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line478")'> 478: </pre>
<pre id='line478' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line479")'> 479:     # calculate</pre>
<pre id='line479' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line480")'> 480:     cdef:</pre>
<pre id='line480' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line481")'> 481:         int *ind = &lt;int*&gt;indices.data</pre>
<pre id='line481' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":481
 *     # calculate
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int *ptr = <code><</code>int*>indptr.data
 *         complex *dat = <code><</code>complex*>data.data
 */
  __pyx_v_ind = ((int *)__pyx_v_indices->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line482")'> 482:         int *ptr = &lt;int*&gt;indptr.data</pre>
<pre id='line482' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":482
 *     cdef:
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *dat = <code><</code>complex*>data.data
 *         complex *mom = <code><</code>complex*>out.data
 */
  __pyx_v_ptr = ((int *)__pyx_v_indptr->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line483")'> 483:         complex *dat = &lt;complex*&gt;data.data</pre>
<pre id='line483' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":483
 *         int *ind = <code><</code>int*>indices.data
 *         int *ptr = <code><</code>int*>indptr.data
 *         complex *dat = <code><</code>complex*>data.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *mom = <code><</code>complex*>out.data
 *         complex *sta = <code><</code>complex*>state.data
 */
  __pyx_v_dat = ((__pyx_t_double_complex *)__pyx_v_data->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line484")'> 484:         complex *mom = &lt;complex*&gt;out.data</pre>
<pre id='line484' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":484
 *         int *ptr = <code><</code>int*>indptr.data
 *         complex *dat = <code><</code>complex*>data.data
 *         complex *mom = <code><</code>complex*>out.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *sta = <code><</code>complex*>state.data
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 */
  __pyx_v_mom = ((__pyx_t_double_complex *)__pyx_v_out->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line485")'> 485:         complex *sta = &lt;complex*&gt;state.data</pre>
<pre id='line485' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":485
 *         complex *dat = <code><</code>complex*>data.data
 *         complex *mom = <code><</code>complex*>out.data
 *         complex *sta = <code><</code>complex*>state.data             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 */
  __pyx_v_sta = ((__pyx_t_double_complex *)__pyx_v_state->data);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line486")'> 486:         complex *phi0 = &lt;complex*&gt;libc.stdlib.malloc(sizeof(complex)*rank)</pre>
<pre id='line486' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":486
 *         complex *mom = <code><</code>complex*>out.data
 *         complex *sta = <code><</code>complex*>state.data
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi2 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 */
  __pyx_v_phi0 = ((__pyx_t_double_complex *)malloc(((sizeof(__pyx_t_double_complex)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line487")'> 487:         complex *phi1 = &lt;complex*&gt;libc.stdlib.malloc(sizeof(complex)*rank)</pre>
<pre id='line487' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":487
 *         complex *sta = <code><</code>complex*>state.data
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         complex *phi2 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         double  re0, im0, re1, im1  # temporary reduction variables
 */
  __pyx_v_phi1 = ((__pyx_t_double_complex *)malloc(((sizeof(__pyx_t_double_complex)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line488")'> 488:         complex *phi2 = &lt;complex*&gt;libc.stdlib.malloc(sizeof(complex)*rank)</pre>
<pre id='line488' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":488
 *         complex *phi0 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi1 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)
 *         complex *phi2 = <code><</code>complex*>libc.stdlib.malloc(sizeof(complex)*rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         double  re0, im0, re1, im1  # temporary reduction variables
 *         complex m0, m1
 */
  __pyx_v_phi2 = ((__pyx_t_double_complex *)malloc(((sizeof(__pyx_t_double_complex)) * __pyx_v_rank)));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line489")'> 489:         double  re0, im0, re1, im1  # temporary reduction variables</pre>
<pre id='line489' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line490")'> 490:         complex m0, m1</pre>
<pre id='line490' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line491")'> 491:         int     i, j, k</pre>
<pre id='line491' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line492")'> 492:     try:</pre>
<pre id='line492' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":492
 *         complex m0, m1
 *         int     i, j, k
 *     try:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):
 */
  /*try:*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line493")'> 493:         # calculate first two orders of the Chebychev expansion</pre>
<pre id='line493' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line494")'> 494:         for k in prange(rank, nogil=True):</pre>
<pre id='line494' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":494
 *     try:
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex_omp(phi0, phi0, rank)
 */
    {
        #ifdef WITH_THREAD
        PyThreadState *_save = NULL;
        #endif
        Py_UNBLOCK_THREADS
        /*try:*/ {
          __pyx_t_8 = __pyx_v_rank;
          if (1 == 0) abort();
          {
              __pyx_t_18 = (__pyx_t_8 - 0) / 1;
              if (__pyx_t_18 > 0)
              {
                  __pyx_v_k = 0;
                  #ifdef _OPENMP
                  #pragma omp parallel
                  #endif /* _OPENMP */
                  {
                      #ifdef _OPENMP
                      #pragma omp for firstprivate(__pyx_v_k) lastprivate(__pyx_v_k)
                      #endif /* _OPENMP */
                      for (__pyx_t_17 = 0; __pyx_t_17 <code><</code> __pyx_t_18; __pyx_t_17++){
                          {
                              __pyx_v_k = 0 + 1 * __pyx_t_17;

        /* "kpm/mom.pyx":494
 *     try:
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex_omp(phi0, phi0, rank)
 */
        /*finally:*/ {
          Py_BLOCK_THREADS
        }
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line495")'> 495:             phi0[k] = sta[k]</pre>
<pre id='line495' class='code' style='background-color: #FFFFff'>
                              /* "kpm/mom.pyx":495
 *         # calculate first two orders of the Chebychev expansion
 *         for k in prange(rank, nogil=True):
 *             phi0[k] = sta[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[0] = dot_complex_omp(phi0, phi0, rank)
 *         matvec_csr_complex_omp(ind, ptr, dat, rank, phi0, phi1)
 */
                              (__pyx_v_phi0[__pyx_v_k]) = (__pyx_v_sta[__pyx_v_k]);
                          }
                      }
                  }
              }
          }
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line496")'> 496:         mom[0] = dot_complex_omp(phi0, phi0, rank)</pre>
<pre id='line496' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":496
 *         for k in prange(rank, nogil=True):
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex_omp(phi0, phi0, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         matvec_csr_complex_omp(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_complex_omp(phi0, phi1, rank)
 */
    (__pyx_v_mom[0]) = __pyx_f_3kpm_3mom_dot_complex_omp(__pyx_v_phi0, __pyx_v_phi0, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line497")'> 497:         matvec_csr_complex_omp(ind, ptr, dat, rank, phi0, phi1)</pre>
<pre id='line497' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":497
 *             phi0[k] = sta[k]
 *         mom[0] = dot_complex_omp(phi0, phi0, rank)
 *         matvec_csr_complex_omp(ind, ptr, dat, rank, phi0, phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         mom[1] = dot_complex_omp(phi0, phi1, rank)
 * 
 */
    __pyx_f_3kpm_3mom_matvec_csr_complex_omp(__pyx_v_ind, __pyx_v_ptr, __pyx_v_dat, __pyx_v_rank, __pyx_v_phi0, __pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line498")'> 498:         mom[1] = dot_complex_omp(phi0, phi1, rank)</pre>
<pre id='line498' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":498
 *         mom[0] = dot_complex_omp(phi0, phi0, rank)
 *         matvec_csr_complex_omp(ind, ptr, dat, rank, phi0, phi1)
 *         mom[1] = dot_complex_omp(phi0, phi1, rank)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         # main iteration loop
 */
    (__pyx_v_mom[1]) = __pyx_f_3kpm_3mom_dot_complex_omp(__pyx_v_phi0, __pyx_v_phi1, __pyx_v_rank);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line499")'> 499: </pre>
<pre id='line499' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line500")'> 500:         # main iteration loop</pre>
<pre id='line500' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line501")'> 501:         for i in range(1, limit/2):</pre>
<pre id='line501' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":501
 * 
 *         # main iteration loop
 *         for i in range(1, limit/2):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # initialize temporary reduction variables
 *             re0 = 0
 */
    __pyx_t_19 = (__pyx_v_limit / 2);
    for (__pyx_t_18 = 1; __pyx_t_18 <code><</code> __pyx_t_19; __pyx_t_18+=1) {
      __pyx_v_i = __pyx_t_18;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line502")'> 502:             # initialize temporary reduction variables</pre>
<pre id='line502' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line503")'> 503:             re0 = 0</pre>
<pre id='line503' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":503
 *         for i in range(1, limit/2):
 *             # initialize temporary reduction variables
 *             re0 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             im0 = 0
 *             re1 = 0
 */
      __pyx_v_re0 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line504")'> 504:             im0 = 0</pre>
<pre id='line504' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":504
 *             # initialize temporary reduction variables
 *             re0 = 0
 *             im0 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             re1 = 0
 *             im1 = 0
 */
      __pyx_v_im0 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line505")'> 505:             re1 = 0</pre>
<pre id='line505' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":505
 *             re0 = 0
 *             im0 = 0
 *             re1 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             im1 = 0
 * 
 */
      __pyx_v_re1 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line506")'> 506:             im1 = 0</pre>
<pre id='line506' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":506
 *             im0 = 0
 *             re1 = 0
 *             im1 = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             for k in prange(rank, nogil=True):
 */
      __pyx_v_im1 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line507")'> 507: </pre>
<pre id='line507' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line508")'> 508:             for k in prange(rank, nogil=True):</pre>
<pre id='line508' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":508
 *             im1 = 0
 * 
 *             for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 */
      {
          #ifdef WITH_THREAD
          PyThreadState *_save = NULL;
          #endif
          Py_UNBLOCK_THREADS
          /*try:*/ {
            __pyx_t_17 = __pyx_v_rank;
            if (1 == 0) abort();
            {
                __pyx_t_20 = (__pyx_t_17 - 0) / 1;
                if (__pyx_t_20 > 0)
                {
                    __pyx_v_k = 0;
                    #ifdef _OPENMP
                    #pragma omp parallel
                    #endif /* _OPENMP */
                    {
                        #ifdef _OPENMP
                        #pragma omp for reduction(+:__pyx_v_im0) reduction(+:__pyx_v_re0) lastprivate(__pyx_v_m1) lastprivate(__pyx_v_m0) reduction(+:__pyx_v_re1) lastprivate(__pyx_v_j) firstprivate(__pyx_v_k) lastprivate(__pyx_v_k) reduction(+:__pyx_v_im1)
                        #endif /* _OPENMP */
                        for (__pyx_t_8 = 0; __pyx_t_8 <code><</code> __pyx_t_20; __pyx_t_8++){
                            {
                                __pyx_v_k = 0 + 1 * __pyx_t_8;
                                /* Initialize private variables to invalid values */
                                __pyx_v_j = ((int)0xbad0bad0);

          /* "kpm/mom.pyx":508
 *             im1 = 0
 * 
 *             for k in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 */
          /*finally:*/ {
            Py_BLOCK_THREADS
          }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line509")'> 509:                 # CSR-matrix-vector multiplication</pre>
<pre id='line509' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line510")'> 510:                 phi2[k] = 0</pre>
<pre id='line510' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":510
 *             for k in prange(rank, nogil=True):
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 */
                                (__pyx_v_phi2[__pyx_v_k]) = __pyx_t_double_complex_from_parts(0, 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line511")'> 511:                 for j in range(ptr[k], ptr[k+1]):</pre>
<pre id='line511' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":511
 *                 # CSR-matrix-vector multiplication
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]
 */
                                __pyx_t_21 = (__pyx_v_ptr[(__pyx_v_k + 1)]);
                                for (__pyx_t_22 = (__pyx_v_ptr[__pyx_v_k]); __pyx_t_22 <code><</code> __pyx_t_21; __pyx_t_22+=1) {
                                  __pyx_v_j = __pyx_t_22;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line512")'> 512:                     phi2[k] += 2*dat[j]*phi1[ind[j]]</pre>
<pre id='line512' class='code' style='background-color: #FFFFff'>
                                  /* "kpm/mom.pyx":512
 *                 phi2[k] = 0
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 phi2[k] -= phi0[k]
 * 
 */
                                  __pyx_t_23 = __pyx_v_k;
                                  (__pyx_v_phi2[__pyx_t_23]) = __Pyx_c_sum((__pyx_v_phi2[__pyx_t_23]), __Pyx_c_prod(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), (__pyx_v_dat[__pyx_v_j])), (__pyx_v_phi1[(__pyx_v_ind[__pyx_v_j])])));
                                }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line513")'> 513:                 phi2[k] -= phi0[k]</pre>
<pre id='line513' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":513
 *                 for j in range(ptr[k], ptr[k+1]):
 *                     phi2[k] += 2*dat[j]*phi1[ind[j]]
 *                 phi2[k] -= phi0[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # calculate Chebychev moments, part 1
 */
                                __pyx_t_21 = __pyx_v_k;
                                (__pyx_v_phi2[__pyx_t_21]) = __Pyx_c_diff((__pyx_v_phi2[__pyx_t_21]), (__pyx_v_phi0[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line514")'> 514: </pre>
<pre id='line514' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line515")'> 515:                 # calculate Chebychev moments, part 1</pre>
<pre id='line515' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line516")'> 516:                 m0 = 2*phi1[k].conjugate()*phi1[k]</pre>
<pre id='line516' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":516
 * 
 *                 # calculate Chebychev moments, part 1
 *                 m0 = 2*phi1[k].conjugate()*phi1[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 m1 = 2*phi2[k].conjugate()*phi1[k]
 * 
 */
                                __pyx_v_m0 = __Pyx_c_prod(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), __Pyx_c_conj((__pyx_v_phi1[__pyx_v_k]))), (__pyx_v_phi1[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line517")'> 517:                 m1 = 2*phi2[k].conjugate()*phi1[k]</pre>
<pre id='line517' class='code' style='background-color: #FFFFff'>
                                /* "kpm/mom.pyx":517
 *                 # calculate Chebychev moments, part 1
 *                 m0 = 2*phi1[k].conjugate()*phi1[k]
 *                 m1 = 2*phi2[k].conjugate()*phi1[k]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *                 # use temporary reduction variables so that Cython/OpenMP
 */
                                __pyx_v_m1 = __Pyx_c_prod(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), __Pyx_c_conj((__pyx_v_phi2[__pyx_v_k]))), (__pyx_v_phi1[__pyx_v_k]));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line518")'> 518: </pre>
<pre id='line518' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line519")'> 519:                 # use temporary reduction variables so that Cython/OpenMP</pre>
<pre id='line519' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line520")'> 520:                 # understands</pre>
<pre id='line520' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line521")'> 521:                 re0 += m0.real  # reduction for mom[i*2]</pre>
<pre id='line521' class='code' style='background-color: #FFFFe7'>
                                /* "kpm/mom.pyx":521
 *                 # use temporary reduction variables so that Cython/OpenMP
 *                 # understands
 *                 re0 += m0.real  # reduction for mom[i*2]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 im0 += m0.imag
 *                 re1 += m1.real  # reduction for mom[i*2+1]
 */
                                __pyx_v_re0 = (__pyx_v_re0 + <span class='pyx_macro_api'>__Pyx_CREAL</span>(__pyx_v_m0));
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line522")'> 522:                 im0 += m0.imag</pre>
<pre id='line522' class='code' style='background-color: #FFFFe7'>
                                /* "kpm/mom.pyx":522
 *                 # understands
 *                 re0 += m0.real  # reduction for mom[i*2]
 *                 im0 += m0.imag             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 re1 += m1.real  # reduction for mom[i*2+1]
 *                 im1 += m1.imag
 */
                                __pyx_v_im0 = (__pyx_v_im0 + <span class='pyx_macro_api'>__Pyx_CIMAG</span>(__pyx_v_m0));
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line523")'> 523:                 re1 += m1.real  # reduction for mom[i*2+1]</pre>
<pre id='line523' class='code' style='background-color: #FFFFe7'>
                                /* "kpm/mom.pyx":523
 *                 re0 += m0.real  # reduction for mom[i*2]
 *                 im0 += m0.imag
 *                 re1 += m1.real  # reduction for mom[i*2+1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                 im1 += m1.imag
 * 
 */
                                __pyx_v_re1 = (__pyx_v_re1 + <span class='pyx_macro_api'>__Pyx_CREAL</span>(__pyx_v_m1));
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line524")'> 524:                 im1 += m1.imag</pre>
<pre id='line524' class='code' style='background-color: #FFFFe7'>
                                /* "kpm/mom.pyx":524
 *                 im0 += m0.imag
 *                 re1 += m1.real  # reduction for mom[i*2+1]
 *                 im1 += m1.imag             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # calculate Chebychev moments, part 2
 */
                                __pyx_v_im1 = (__pyx_v_im1 + <span class='pyx_macro_api'>__Pyx_CIMAG</span>(__pyx_v_m1));
                            }
                        }
                    }
                }
            }
          }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line525")'> 525: </pre>
<pre id='line525' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line526")'> 526:             # calculate Chebychev moments, part 2</pre>
<pre id='line526' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line527")'> 527:             mom[i*2] = complex(re0, im0)-mom[0]</pre>
<pre id='line527' class='code' style='background-color: #FFFF2d'>
      /* "kpm/mom.pyx":527
 * 
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = complex(re0, im0)-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             mom[i*2+1] = complex(re1, im1)-mom[1]
 * 
 */
      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_re0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_im0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_6));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_5);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_3);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
      __pyx_t_5 = 0;
      __pyx_t_3 = 0;
      __pyx_t_3 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyComplex_Type))), ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      __pyx_t_6 = __pyx_<span class='py_c_api'>PyComplex_FromComplex</span>((__pyx_v_mom[0]));<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_6));
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_3, ((PyObject *)__pyx_t_6));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
      __pyx_t_24 = __Pyx_<span class='py_c_api'>PyComplex_As___pyx_t_double_complex</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 527; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      (__pyx_v_mom[(__pyx_v_i * 2)]) = __pyx_t_24;
</pre><pre class='line' style='background-color: #FFFF2d' onclick='toggleDiv("line528")'> 528:             mom[i*2+1] = complex(re1, im1)-mom[1]</pre>
<pre id='line528' class='code' style='background-color: #FFFF2d'>
      /* "kpm/mom.pyx":528
 *             # calculate Chebychev moments, part 2
 *             mom[i*2] = complex(re0, im0)-mom[0]
 *             mom[i*2+1] = complex(re1, im1)-mom[1]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *             # shift states circular
 */
      __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_re1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_im1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_5);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_6);
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_6);
      __pyx_t_5 = 0;
      __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyComplex_Type))), ((PyObject *)__pyx_t_3), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_3 = __pyx_<span class='py_c_api'>PyComplex_FromComplex</span>((__pyx_v_mom[1]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_3));
      __pyx_t_5 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_6, ((PyObject *)__pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_3)); __pyx_t_3 = 0;
      __pyx_t_24 = __Pyx_<span class='py_c_api'>PyComplex_As___pyx_t_double_complex</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 528; __pyx_clineno = __LINE__; goto __pyx_L15;}</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      (__pyx_v_mom[((__pyx_v_i * 2) + 1)]) = __pyx_t_24;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line529")'> 529: </pre>
<pre id='line529' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line530")'> 530:             # shift states circular</pre>
<pre id='line530' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line531")'> 531:             shift3_complex(&amp;phi0, &amp;phi1, &amp;phi2)</pre>
<pre id='line531' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":531
 * 
 *             # shift states circular
 *             shift3_complex(&phi0, &phi1, &phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *         if limit % 2 == 1:
 */
      __pyx_f_3kpm_3mom_shift3_complex((&__pyx_v_phi0), (&__pyx_v_phi1), (&__pyx_v_phi2));
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line532")'> 532: </pre>
<pre id='line532' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line533")'> 533:         if limit % 2 == 1:</pre>
<pre id='line533' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":533
 *             shift3_complex(&phi0, &phi1, &phi2)
 * 
 *         if limit % 2 == 1:             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 */
    __pyx_t_12 = ((__pyx_v_limit % 2) == 1);
    if (__pyx_t_12) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line534")'> 534:             # calculate last Chebychev moment in case of an odd truncation</pre>
<pre id='line534' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line535")'> 535:             # number</pre>
<pre id='line535' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line536")'> 536:             mom[limit-1] = 2*dot_complex_omp(phi1, phi1, rank)-mom[0]</pre>
<pre id='line536' class='code' style='background-color: #FFFFff'>
      /* "kpm/mom.pyx":536
 *             # calculate last Chebychev moment in case of an odd truncation
 *             # number
 *             mom[limit-1] = 2*dot_complex_omp(phi1, phi1, rank)-mom[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     finally:
 */
      (__pyx_v_mom[(__pyx_v_limit - 1)]) = __Pyx_c_diff(__Pyx_c_prod(__pyx_t_double_complex_from_parts(2, 0), __pyx_f_3kpm_3mom_dot_complex_omp(__pyx_v_phi1, __pyx_v_phi1, __pyx_v_rank)), (__pyx_v_mom[0]));
      goto __pyx_L41;
    }
    __pyx_L41:;
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line537")'> 537: </pre>
<pre id='line537' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line538")'> 538:     finally:</pre>
<pre id='line538' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line539")'> 539:         # clean up memory</pre>
<pre id='line539' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line540")'> 540:         libc.stdlib.free(phi0)</pre>
<pre id='line540' class='code' style='background-color: #FFFF9f'>
  /* "kpm/mom.pyx":540
 *     finally:
 *         # clean up memory
 *         libc.stdlib.free(phi0)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)
 */
  /*finally:*/ {
    int __pyx_why;
    PyObject *__pyx_exc_type, *__pyx_exc_value, *__pyx_exc_tb;
    int __pyx_exc_lineno;
    __pyx_exc_type = 0; __pyx_exc_value = 0; __pyx_exc_tb = 0; __pyx_exc_lineno = 0;
    __pyx_why = 0; goto __pyx_L16;
    __pyx_L15: {
      __pyx_why = 4;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_exc_type, &__pyx_exc_value, &__pyx_exc_tb);
      __pyx_exc_lineno = __pyx_lineno;
      goto __pyx_L16;
    }
    __pyx_L16:;
    free(__pyx_v_phi0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line541")'> 541:         libc.stdlib.free(phi1)</pre>
<pre id='line541' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":541
 *         # clean up memory
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         libc.stdlib.free(phi2)
 * 
 */
    free(__pyx_v_phi1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line542")'> 542:         libc.stdlib.free(phi2)</pre>
<pre id='line542' class='code' style='background-color: #FFFFd4'>
    /* "kpm/mom.pyx":542
 *         libc.stdlib.free(phi0)
 *         libc.stdlib.free(phi1)
 *         libc.stdlib.free(phi2)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     # return
 */
    free(__pyx_v_phi2);
    switch (__pyx_why) {
      case 4: {
        <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_exc_type, __pyx_exc_value, __pyx_exc_tb);
        __pyx_lineno = __pyx_exc_lineno;
        __pyx_exc_type = 0;
        __pyx_exc_value = 0;
        __pyx_exc_tb = 0;
        goto __pyx_L1_error;
      }
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line543")'> 543: </pre>
<pre id='line543' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line544")'> 544:     # return</pre>
<pre id='line544' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF2b' onclick='toggleDiv("line545")'> 545:     return &lt;object&gt;out if do_return else None</pre>
<pre id='line545' class='code' style='background-color: #FFFF2b'>
  /* "kpm/mom.pyx":545
 * 
 *     # return
 *     return <code><</code>object>out if do_return else None             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_12 = __Pyx_<span class='py_c_api'>PyObject_IsTrue</span>(__pyx_v_do_return);<span class='error_goto'> if (unlikely(__pyx_t_12 <code><</code> 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 545; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  if (__pyx_t_12) {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_out));
    __pyx_t_5 = ((PyObject *)__pyx_v_out);
  } else {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    __pyx_t_5 = Py_None;
  }
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&__pyx_type, &__pyx_value, &__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom._expec_csr_complex_omp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_out);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indptr);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_state);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_data);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&__pyx_bstruct_indices);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___modified__);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_do_return);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indices);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_indptr);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_data);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_state);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_out);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line546")'> 546: </pre>
<pre id='line546' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line547")'> 547: </pre>
<pre id='line547' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line548")'> 548: #===========#</pre>
<pre id='line548' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line549")'> 549: # Utilities #</pre>
<pre id='line549' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line550")'> 550: #===========#</pre>
<pre id='line550' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line551")'> 551: </pre>
<pre id='line551' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line552")'> 552: </pre>
<pre id='line552' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line553")'> 553: @cython.cdivision(True)</pre>
<pre id='line553' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line554")'> 554: @cython.boundscheck(False)</pre>
<pre id='line554' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line555")'> 555: cdef inline double dot_real(double *a, double *b, int length):</pre>
<pre id='line555' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":555
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline double dot_real(double *a, double *b, int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """double dot_real(double *a, double *b, int length)
 * 
 */

static CYTHON_INLINE double __pyx_f_3kpm_3mom_dot_real(double *__pyx_v_a, double *__pyx_v_b, int __pyx_v_length) {
  double __pyx_v_out;
  int __pyx_v_i;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("dot_real");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line556")'> 556:     """double dot_real(double *a, double *b, int length)</pre>
<pre id='line556' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line557")'> 557: </pre>
<pre id='line557' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line558")'> 558:     Calcualte dot product of the two given real vectors "a" and "b" with the</pre>
<pre id='line558' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line559")'> 559:     given length "length"."""</pre>
<pre id='line559' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line560")'> 560:     # 2012-08-17</pre>
<pre id='line560' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line561")'> 561:     # based on tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11</pre>
<pre id='line561' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line562")'> 562:     cdef:</pre>
<pre id='line562' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line563")'> 563:         double out = 0</pre>
<pre id='line563' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":563
 *     # based on tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11
 *     cdef:
 *         double out = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int    i
 *     for i in range(length):
 */
  __pyx_v_out = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line564")'> 564:         int    i</pre>
<pre id='line564' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line565")'> 565:     for i in range(length):</pre>
<pre id='line565' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":565
 *         double out = 0
 *         int    i
 *     for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out += a[i]*b[i]
 *     return out
 */
  __pyx_t_1 = __pyx_v_length;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line566")'> 566:         out += a[i]*b[i]</pre>
<pre id='line566' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":566
 *         int    i
 *     for i in range(length):
 *         out += a[i]*b[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return out
 * 
 */
    __pyx_v_out = (__pyx_v_out + ((__pyx_v_a[__pyx_v_i]) * (__pyx_v_b[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line567")'> 567:     return out</pre>
<pre id='line567' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":567
 *     for i in range(length):
 *         out += a[i]*b[i]
 *     return out             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line568")'> 568: </pre>
<pre id='line568' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line569")'> 569: </pre>
<pre id='line569' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line570")'> 570: @cython.cdivision(True)</pre>
<pre id='line570' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line571")'> 571: @cython.boundscheck(False)</pre>
<pre id='line571' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line572")'> 572: cdef inline double dot_real_omp(double *a, double *b, int length):</pre>
<pre id='line572' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":572
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline double dot_real_omp(double *a, double *b, int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """double dot_real_omp(double *a, double *b, int length)
 * 
 */

static CYTHON_INLINE double __pyx_f_3kpm_3mom_dot_real_omp(double *__pyx_v_a, double *__pyx_v_b, int __pyx_v_length) {
  double __pyx_v_out;
  int __pyx_v_i;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("dot_real_omp");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line573")'> 573:     """double dot_real_omp(double *a, double *b, int length)</pre>
<pre id='line573' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line574")'> 574: </pre>
<pre id='line574' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line575")'> 575:     Calcualte dot product of the two given real vectors "a" and "b" with the</pre>
<pre id='line575' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line576")'> 576:     given length "length", using OpenMP parallelization."""</pre>
<pre id='line576' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line577")'> 577:     # 2012-08-17</pre>
<pre id='line577' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line578")'> 578:     # former tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11</pre>
<pre id='line578' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line579")'> 579:     cdef:</pre>
<pre id='line579' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line580")'> 580:         double out = 0</pre>
<pre id='line580' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":580
 *     # former tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11
 *     cdef:
 *         double out = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int    i
 *     for i in prange(length, nogil=True):
 */
  __pyx_v_out = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line581")'> 581:         int    i</pre>
<pre id='line581' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line582")'> 582:     for i in prange(length, nogil=True):</pre>
<pre id='line582' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":582
 *         double out = 0
 *         int    i
 *     for i in prange(length, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out += a[i]*b[i]
 *     return out
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save = NULL;
      #endif
      Py_UNBLOCK_THREADS
      /*try:*/ {
        __pyx_t_1 = __pyx_v_length;
        if (1 == 0) abort();
        {
            __pyx_t_3 = (__pyx_t_1 - 0) / 1;
            if (__pyx_t_3 > 0)
            {
                __pyx_v_i = 0;
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for reduction(+:__pyx_v_out) firstprivate(__pyx_v_i) lastprivate(__pyx_v_i)
                    #endif /* _OPENMP */
                    for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_3; __pyx_t_2++){
                        {
                            __pyx_v_i = 0 + 1 * __pyx_t_2;

      /* "kpm/mom.pyx":582
 *         double out = 0
 *         int    i
 *     for i in prange(length, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out += a[i]*b[i]
 *     return out
 */
      /*finally:*/ {
        Py_BLOCK_THREADS
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line583")'> 583:         out += a[i]*b[i]</pre>
<pre id='line583' class='code' style='background-color: #FFFFff'>
                            /* "kpm/mom.pyx":583
 *         int    i
 *     for i in prange(length, nogil=True):
 *         out += a[i]*b[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return out
 * 
 */
                            __pyx_v_out = (__pyx_v_out + ((__pyx_v_a[__pyx_v_i]) * (__pyx_v_b[__pyx_v_i])));
                        }
                    }
                }
            }
        }
      }
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line584")'> 584:     return out</pre>
<pre id='line584' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":584
 *     for i in prange(length, nogil=True):
 *         out += a[i]*b[i]
 *     return out             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;

  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line585")'> 585: </pre>
<pre id='line585' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line586")'> 586: </pre>
<pre id='line586' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line587")'> 587: @cython.cdivision(True)</pre>
<pre id='line587' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line588")'> 588: @cython.boundscheck(False)</pre>
<pre id='line588' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line589")'> 589: cdef inline complex dot_complex(complex *a, complex *b, int length):</pre>
<pre id='line589' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":589
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline complex dot_complex(complex *a, complex *b, int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """complex dot_complex(complex *a, complex *b, int length)
 * 
 */

static CYTHON_INLINE __pyx_t_double_complex __pyx_f_3kpm_3mom_dot_complex(__pyx_t_double_complex *__pyx_v_a, __pyx_t_double_complex *__pyx_v_b, int __pyx_v_length) {
  __pyx_t_double_complex __pyx_v_out;
  int __pyx_v_i;
  __pyx_t_double_complex __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("dot_complex");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line590")'> 590:     """complex dot_complex(complex *a, complex *b, int length)</pre>
<pre id='line590' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line591")'> 591: </pre>
<pre id='line591' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line592")'> 592:     Calcualte dot product of the two complex vectors "a" and "b" with the</pre>
<pre id='line592' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line593")'> 593:     given length "length"."""</pre>
<pre id='line593' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line594")'> 594:     # 2012-08-17</pre>
<pre id='line594' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line595")'> 595:     # based on tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11</pre>
<pre id='line595' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line596")'> 596:     cdef:</pre>
<pre id='line596' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line597")'> 597:         complex out = 0</pre>
<pre id='line597' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":597
 *     # based on tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11
 *     cdef:
 *         complex out = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int    i
 *     for i in range(length):
 */
  __pyx_v_out = __pyx_t_double_complex_from_parts(0, 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line598")'> 598:         int    i</pre>
<pre id='line598' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line599")'> 599:     for i in range(length):</pre>
<pre id='line599' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":599
 *         complex out = 0
 *         int    i
 *     for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out += a[i].conjugate()*b[i]
 *     return out
 */
  __pyx_t_1 = __pyx_v_length;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line600")'> 600:         out += a[i].conjugate()*b[i]</pre>
<pre id='line600' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":600
 *         int    i
 *     for i in range(length):
 *         out += a[i].conjugate()*b[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return out
 * 
 */
    __pyx_v_out = __Pyx_c_sum(__pyx_v_out, __Pyx_c_prod(__Pyx_c_conj((__pyx_v_a[__pyx_v_i])), (__pyx_v_b[__pyx_v_i])));
  }
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line601")'> 601:     return out</pre>
<pre id='line601' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":601
 *     for i in range(length):
 *         out += a[i].conjugate()*b[i]
 *     return out             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_r = __pyx_v_out;
  goto __pyx_L0;

  __pyx_r = __pyx_t_double_complex_from_parts(0, 0);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line602")'> 602: </pre>
<pre id='line602' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line603")'> 603: </pre>
<pre id='line603' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line604")'> 604: @cython.cdivision(True)</pre>
<pre id='line604' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line605")'> 605: @cython.boundscheck(False)</pre>
<pre id='line605' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line606")'> 606: cdef inline complex dot_complex_omp(complex *a, complex *b, int length):</pre>
<pre id='line606' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":606
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline complex dot_complex_omp(complex *a, complex *b, int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """complex dot_complex_omp(complex *a, complex *b, int length)
 * 
 */

static CYTHON_INLINE __pyx_t_double_complex __pyx_f_3kpm_3mom_dot_complex_omp(__pyx_t_double_complex *__pyx_v_a, __pyx_t_double_complex *__pyx_v_b, int __pyx_v_length) {
  __pyx_t_double_complex __pyx_v_temp;
  double __pyx_v_re;
  double __pyx_v_im;
  int __pyx_v_i;
  __pyx_t_double_complex __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("dot_complex_omp");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line607")'> 607:     """complex dot_complex_omp(complex *a, complex *b, int length)</pre>
<pre id='line607' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line608")'> 608: </pre>
<pre id='line608' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line609")'> 609:     Calcualte dot product of the two complex vectors "a" and "b" with the</pre>
<pre id='line609' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line610")'> 610:     given length "length", using OpenMP parallelization."""</pre>
<pre id='line610' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line611")'> 611:     # 2012-08-17 until 2012-08-20</pre>
<pre id='line611' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line612")'> 612:     # based on tb.kpm.core.dot, developed from 2011-12-08 until 2011-12-11</pre>
<pre id='line612' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line613")'> 613:     cdef:</pre>
<pre id='line613' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line614")'> 614:         complex temp</pre>
<pre id='line614' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line615")'> 615:         double  re = 0, im = 0</pre>
<pre id='line615' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":615
 *     cdef:
 *         complex temp
 *         double  re = 0, im = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         int     i
 *     for i in prange(length, nogil=True):
 */
  __pyx_v_re = 0.0;
  __pyx_v_im = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line616")'> 616:         int     i</pre>
<pre id='line616' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line617")'> 617:     for i in prange(length, nogil=True):</pre>
<pre id='line617' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":617
 *         double  re = 0, im = 0
 *         int     i
 *     for i in prange(length, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         temp = a[i].conjugate()*b[i]
 *         re += temp.real
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save = NULL;
      #endif
      Py_UNBLOCK_THREADS
      /*try:*/ {
        __pyx_t_1 = __pyx_v_length;
        if (1 == 0) abort();
        {
            __pyx_t_3 = (__pyx_t_1 - 0) / 1;
            if (__pyx_t_3 > 0)
            {
                __pyx_v_i = 0;
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for firstprivate(__pyx_v_i) lastprivate(__pyx_v_i) reduction(+:__pyx_v_re) reduction(+:__pyx_v_im) lastprivate(__pyx_v_temp)
                    #endif /* _OPENMP */
                    for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_3; __pyx_t_2++){
                        {
                            __pyx_v_i = 0 + 1 * __pyx_t_2;

      /* "kpm/mom.pyx":617
 *         double  re = 0, im = 0
 *         int     i
 *     for i in prange(length, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         temp = a[i].conjugate()*b[i]
 *         re += temp.real
 */
      /*finally:*/ {
        Py_BLOCK_THREADS
      }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line618")'> 618:         temp = a[i].conjugate()*b[i]</pre>
<pre id='line618' class='code' style='background-color: #FFFFff'>
                            /* "kpm/mom.pyx":618
 *         int     i
 *     for i in prange(length, nogil=True):
 *         temp = a[i].conjugate()*b[i]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         re += temp.real
 *         im += temp.imag
 */
                            __pyx_v_temp = __Pyx_c_prod(__Pyx_c_conj((__pyx_v_a[__pyx_v_i])), (__pyx_v_b[__pyx_v_i]));
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line619")'> 619:         re += temp.real</pre>
<pre id='line619' class='code' style='background-color: #FFFFe7'>
                            /* "kpm/mom.pyx":619
 *     for i in prange(length, nogil=True):
 *         temp = a[i].conjugate()*b[i]
 *         re += temp.real             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         im += temp.imag
 *     return complex(re, im)
 */
                            __pyx_v_re = (__pyx_v_re + <span class='pyx_macro_api'>__Pyx_CREAL</span>(__pyx_v_temp));
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line620")'> 620:         im += temp.imag</pre>
<pre id='line620' class='code' style='background-color: #FFFFe7'>
                            /* "kpm/mom.pyx":620
 *         temp = a[i].conjugate()*b[i]
 *         re += temp.real
 *         im += temp.imag             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     return complex(re, im)
 * 
 */
                            __pyx_v_im = (__pyx_v_im + <span class='pyx_macro_api'>__Pyx_CIMAG</span>(__pyx_v_temp));
                        }
                    }
                }
            }
        }
      }
</pre><pre class='line' style='background-color: #FFFF33' onclick='toggleDiv("line621")'> 621:     return complex(re, im)</pre>
<pre id='line621' class='code' style='background-color: #FFFF33'>
  /* "kpm/mom.pyx":621
 *         re += temp.real
 *         im += temp.imag
 *     return complex(re, im)             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_re);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_im);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_6));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_5);
  __pyx_t_4 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyObject_Call</span>(((PyObject *)((PyObject*)(&PyComplex_Type))), ((PyObject *)__pyx_t_6), NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_6)); __pyx_t_6 = 0;
  __pyx_t_7 = __Pyx_<span class='py_c_api'>PyComplex_As___pyx_t_double_complex</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(<span class='py_c_api'>PyErr_Occurred</span>())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 621; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_r = __pyx_t_7;
  goto __pyx_L0;

  __pyx_r = __pyx_t_double_complex_from_parts(0, 0);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("kpm.mom.dot_complex_omp", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = __pyx_t_double_complex_from_parts(0, 0);
  __pyx_L0:;
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line622")'> 622: </pre>
<pre id='line622' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line623")'> 623: </pre>
<pre id='line623' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line624")'> 624: @cython.cdivision(True)</pre>
<pre id='line624' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line625")'> 625: @cython.boundscheck(False)</pre>
<pre id='line625' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line626")'> 626: cdef inline void matvec_csr_real(int *ind, int *ptr, double *dat, int rank,</pre>
<pre id='line626' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":626
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline void matvec_csr_real(int *ind, int *ptr, double *dat, int rank,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                  double *vect, double *out):
 *     """matvec_csr_real(int *ind, int *ptr, double *dat, int rank,
 */

static CYTHON_INLINE void __pyx_f_3kpm_3mom_matvec_csr_real(int *__pyx_v_ind, int *__pyx_v_ptr, double *__pyx_v_dat, int __pyx_v_rank, double *__pyx_v_vect, double *__pyx_v_out) {
  int __pyx_v_i;
  int __pyx_v_j;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("matvec_csr_real");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line627")'> 627:                                  double *vect, double *out):</pre>
<pre id='line627' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line628")'> 628:     """matvec_csr_real(int *ind, int *ptr, double *dat, int rank,</pre>
<pre id='line628' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line629")'> 629:                     double *vect, double *out)</pre>
<pre id='line629' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line630")'> 630: </pre>
<pre id='line630' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line631")'> 631:     Multiply the given real square CSR sparse matrix, defined by row indices</pre>
<pre id='line631' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line632")'> 632:     "ind", column pointer "ptr", data values "dat" and rank "rank", with the</pre>
<pre id='line632' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line633")'> 633:     given vector "vect". Store the resulting vector in "out" (overwrite).</pre>
<pre id='line633' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line634")'> 634: </pre>
<pre id='line634' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line635")'> 635:     """</pre>
<pre id='line635' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line636")'> 636:     # 2012-08-17</pre>
<pre id='line636' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line637")'> 637:     # based on tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11</pre>
<pre id='line637' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line638")'> 638:     cdef int i, j</pre>
<pre id='line638' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line639")'> 639:     for i in range(rank):</pre>
<pre id='line639' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":639
 *     # based on tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11
 *     cdef int i, j
 *     for i in range(rank):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out[i] = 0.
 *         for j in range(ptr[i], ptr[i+1]):
 */
  __pyx_t_1 = __pyx_v_rank;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line640")'> 640:         out[i] = 0.</pre>
<pre id='line640' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":640
 *     cdef int i, j
 *     for i in range(rank):
 *         out[i] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]
 */
    (__pyx_v_out[__pyx_v_i]) = 0.;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line641")'> 641:         for j in range(ptr[i], ptr[i+1]):</pre>
<pre id='line641' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":641
 *     for i in range(rank):
 *         out[i] = 0.
 *         for j in range(ptr[i], ptr[i+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             out[i] += dat[j]*vect[ind[j]]
 * 
 */
    __pyx_t_3 = (__pyx_v_ptr[(__pyx_v_i + 1)]);
    for (__pyx_t_4 = (__pyx_v_ptr[__pyx_v_i]); __pyx_t_4 <code><</code> __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line642")'> 642:             out[i] += dat[j]*vect[ind[j]]</pre>
<pre id='line642' class='code' style='background-color: #FFFFe7'>
      /* "kpm/mom.pyx":642
 *         out[i] = 0.
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_5 = __pyx_v_i;
      (__pyx_v_out[__pyx_t_5]) = ((__pyx_v_out[__pyx_t_5]) + ((__pyx_v_dat[__pyx_v_j]) * (__pyx_v_vect[(__pyx_v_ind[__pyx_v_j])])));
    }
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line643")'> 643: </pre>
<pre id='line643' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line644")'> 644: </pre>
<pre id='line644' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line645")'> 645: @cython.cdivision(True)</pre>
<pre id='line645' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line646")'> 646: @cython.boundscheck(False)</pre>
<pre id='line646' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line647")'> 647: cdef inline void matvec_csr_real_omp(int *ind, int *ptr, double *dat, int rank,</pre>
<pre id='line647' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":647
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline void matvec_csr_real_omp(int *ind, int *ptr, double *dat, int rank,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                      double *vect, double *out):
 *     """matvec_csr_real_omp(int *ind, int *ptr, double *dat, int rank,
 */

static CYTHON_INLINE void __pyx_f_3kpm_3mom_matvec_csr_real_omp(int *__pyx_v_ind, int *__pyx_v_ptr, double *__pyx_v_dat, int __pyx_v_rank, double *__pyx_v_vect, double *__pyx_v_out) {
  int __pyx_v_i;
  int __pyx_v_j;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("matvec_csr_real_omp");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line648")'> 648:                                      double *vect, double *out):</pre>
<pre id='line648' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line649")'> 649:     """matvec_csr_real_omp(int *ind, int *ptr, double *dat, int rank,</pre>
<pre id='line649' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line650")'> 650:                         double *vect, double *out)</pre>
<pre id='line650' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line651")'> 651: </pre>
<pre id='line651' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line652")'> 652:     Multiply the given real square CSR sparse matrix, defined by row indices</pre>
<pre id='line652' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line653")'> 653:     "ind", column pointer "ptr", data values "dat" and rank "rank", with the</pre>
<pre id='line653' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line654")'> 654:     given vector "vect". Store the resulting vector in "out" (overwrite).</pre>
<pre id='line654' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line655")'> 655: </pre>
<pre id='line655' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line656")'> 656:     This is the OpenMP variant of the function, using a parallel for-loop."""</pre>
<pre id='line656' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line657")'> 657:     # 2012-08-17</pre>
<pre id='line657' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line658")'> 658:     # former tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11</pre>
<pre id='line658' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line659")'> 659:     cdef int i, j</pre>
<pre id='line659' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line660")'> 660:     for i in prange(rank, nogil=True):</pre>
<pre id='line660' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":660
 *     # former tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11
 *     cdef int i, j
 *     for i in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save = NULL;
      #endif
      Py_UNBLOCK_THREADS
      /*try:*/ {
        __pyx_t_1 = __pyx_v_rank;
        if (1 == 0) abort();
        {
            __pyx_t_3 = (__pyx_t_1 - 0) / 1;
            if (__pyx_t_3 > 0)
            {
                __pyx_v_i = 0;
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for firstprivate(__pyx_v_i) lastprivate(__pyx_v_i) lastprivate(__pyx_v_j)
                    #endif /* _OPENMP */
                    for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_3; __pyx_t_2++){
                        {
                            __pyx_v_i = 0 + 1 * __pyx_t_2;
                            /* Initialize private variables to invalid values */
                            __pyx_v_j = ((int)0xbad0bad0);

      /* "kpm/mom.pyx":660
 *     # former tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11
 *     cdef int i, j
 *     for i in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):
 */
      /*finally:*/ {
        Py_BLOCK_THREADS
      }
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line661")'> 661:         out[i] = 0</pre>
<pre id='line661' class='code' style='background-color: #FFFFff'>
                            /* "kpm/mom.pyx":661
 *     cdef int i, j
 *     for i in prange(rank, nogil=True):
 *         out[i] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]
 */
                            (__pyx_v_out[__pyx_v_i]) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line662")'> 662:         for j in range(ptr[i], ptr[i+1]):</pre>
<pre id='line662' class='code' style='background-color: #FFFFff'>
                            /* "kpm/mom.pyx":662
 *     for i in prange(rank, nogil=True):
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             out[i] += dat[j]*vect[ind[j]]
 * 
 */
                            __pyx_t_4 = (__pyx_v_ptr[(__pyx_v_i + 1)]);
                            for (__pyx_t_5 = (__pyx_v_ptr[__pyx_v_i]); __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
                              __pyx_v_j = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line663")'> 663:             out[i] += dat[j]*vect[ind[j]]</pre>
<pre id='line663' class='code' style='background-color: #FFFFff'>
                              /* "kpm/mom.pyx":663
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
                              __pyx_t_6 = __pyx_v_i;
                              (__pyx_v_out[__pyx_t_6]) = ((__pyx_v_out[__pyx_t_6]) + ((__pyx_v_dat[__pyx_v_j]) * (__pyx_v_vect[(__pyx_v_ind[__pyx_v_j])])));
                            }
                        }
                    }
                }
            }
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line664")'> 664: </pre>
<pre id='line664' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line665")'> 665: </pre>
<pre id='line665' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line666")'> 666: @cython.cdivision(True)</pre>
<pre id='line666' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line667")'> 667: @cython.boundscheck(False)</pre>
<pre id='line667' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line668")'> 668: cdef inline void matvec_csr_complex(int *ind, int *ptr, complex *dat, int rank,</pre>
<pre id='line668' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":668
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline void matvec_csr_complex(int *ind, int *ptr, complex *dat, int rank,             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                     complex *vect, complex *out):
 *     """matvec_csr_complex(int *ind, int *ptr, complex *dat, int rank,
 */

static CYTHON_INLINE void __pyx_f_3kpm_3mom_matvec_csr_complex(int *__pyx_v_ind, int *__pyx_v_ptr, __pyx_t_double_complex *__pyx_v_dat, int __pyx_v_rank, __pyx_t_double_complex *__pyx_v_vect, __pyx_t_double_complex *__pyx_v_out) {
  int __pyx_v_i;
  int __pyx_v_j;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("matvec_csr_complex");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line669")'> 669:                                     complex *vect, complex *out):</pre>
<pre id='line669' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line670")'> 670:     """matvec_csr_complex(int *ind, int *ptr, complex *dat, int rank,</pre>
<pre id='line670' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line671")'> 671:                         complex *vect, complex *out)</pre>
<pre id='line671' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line672")'> 672: </pre>
<pre id='line672' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line673")'> 673:     Multiply the given complex square CSR sparse matrix, defined by row indices</pre>
<pre id='line673' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line674")'> 674:     "ind", column pointer "ptr", data values "dat" and rank "rank", with the</pre>
<pre id='line674' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line675")'> 675:     given complex vector "vect". Store the resulting vector in "out"</pre>
<pre id='line675' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line676")'> 676:     (overwrite).</pre>
<pre id='line676' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line677")'> 677: </pre>
<pre id='line677' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line678")'> 678:     """</pre>
<pre id='line678' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line679")'> 679:     # 2012-08-17</pre>
<pre id='line679' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line680")'> 680:     # based on tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11</pre>
<pre id='line680' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line681")'> 681:     cdef int i, j</pre>
<pre id='line681' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line682")'> 682:     for i in range(rank):</pre>
<pre id='line682' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":682
 *     # based on tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11
 *     cdef int i, j
 *     for i in range(rank):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out[i] = 0.
 *         for j in range(ptr[i], ptr[i+1]):
 */
  __pyx_t_1 = __pyx_v_rank;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line683")'> 683:         out[i] = 0.</pre>
<pre id='line683' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":683
 *     cdef int i, j
 *     for i in range(rank):
 *         out[i] = 0.             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]
 */
    (__pyx_v_out[__pyx_v_i]) = __pyx_t_double_complex_from_parts(0., 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line684")'> 684:         for j in range(ptr[i], ptr[i+1]):</pre>
<pre id='line684' class='code' style='background-color: #FFFFff'>
    /* "kpm/mom.pyx":684
 *     for i in range(rank):
 *         out[i] = 0.
 *         for j in range(ptr[i], ptr[i+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             out[i] += dat[j]*vect[ind[j]]
 * 
 */
    __pyx_t_3 = (__pyx_v_ptr[(__pyx_v_i + 1)]);
    for (__pyx_t_4 = (__pyx_v_ptr[__pyx_v_i]); __pyx_t_4 <code><</code> __pyx_t_3; __pyx_t_4+=1) {
      __pyx_v_j = __pyx_t_4;
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line685")'> 685:             out[i] += dat[j]*vect[ind[j]]</pre>
<pre id='line685' class='code' style='background-color: #FFFFe7'>
      /* "kpm/mom.pyx":685
 *         out[i] = 0.
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
      __pyx_t_5 = __pyx_v_i;
      (__pyx_v_out[__pyx_t_5]) = __Pyx_c_sum((__pyx_v_out[__pyx_t_5]), __Pyx_c_prod((__pyx_v_dat[__pyx_v_j]), (__pyx_v_vect[(__pyx_v_ind[__pyx_v_j])])));
    }
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line686")'> 686: </pre>
<pre id='line686' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line687")'> 687: </pre>
<pre id='line687' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line688")'> 688: @cython.cdivision(True)</pre>
<pre id='line688' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line689")'> 689: @cython.boundscheck(False)</pre>
<pre id='line689' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line690")'> 690: cdef inline void matvec_csr_complex_omp(int *ind, int *ptr, complex *dat, int</pre>
<pre id='line690' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":690
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline void matvec_csr_complex_omp(int *ind, int *ptr, complex *dat, int             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *                                         rank, complex *vect, complex *out):
 *     """matvec_csr_complex_omp(int *ind, int *ptr, complex *dat, int rank,
 */

static CYTHON_INLINE void __pyx_f_3kpm_3mom_matvec_csr_complex_omp(int *__pyx_v_ind, int *__pyx_v_ptr, __pyx_t_double_complex *__pyx_v_dat, int __pyx_v_rank, __pyx_t_double_complex *__pyx_v_vect, __pyx_t_double_complex *__pyx_v_out) {
  int __pyx_v_i;
  int __pyx_v_j;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("matvec_csr_complex_omp");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line691")'> 691:                                         rank, complex *vect, complex *out):</pre>
<pre id='line691' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line692")'> 692:     """matvec_csr_complex_omp(int *ind, int *ptr, complex *dat, int rank,</pre>
<pre id='line692' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line693")'> 693:                             complex *vect, complex *out)</pre>
<pre id='line693' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line694")'> 694: </pre>
<pre id='line694' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line695")'> 695:     Multiply the given complex square CSR sparse matrix, defined by row indices</pre>
<pre id='line695' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line696")'> 696:     "ind", column pointer "ptr", data values "dat" and rank "rank", with the</pre>
<pre id='line696' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line697")'> 697:     given complex vector "vect". Store the resulting vector in "out"</pre>
<pre id='line697' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line698")'> 698:     (overwrite).</pre>
<pre id='line698' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line699")'> 699: </pre>
<pre id='line699' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line700")'> 700:     This is the OpenMP variant of the function, using a parallel for-loop."""</pre>
<pre id='line700' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line701")'> 701:     # 2012-08-17</pre>
<pre id='line701' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line702")'> 702:     # based on tb.kpm.core.matvec, developed from 2011-12-06 until 2011-12-11</pre>
<pre id='line702' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line703")'> 703:     cdef:</pre>
<pre id='line703' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line704")'> 704:         int i, j</pre>
<pre id='line704' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line705")'> 705:     for i in prange(rank, nogil=True):</pre>
<pre id='line705' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":705
 *     cdef:
 *         int i, j
 *     for i in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):
 */
  {
      #ifdef WITH_THREAD
      PyThreadState *_save = NULL;
      #endif
      Py_UNBLOCK_THREADS
      /*try:*/ {
        __pyx_t_1 = __pyx_v_rank;
        if (1 == 0) abort();
        {
            __pyx_t_3 = (__pyx_t_1 - 0) / 1;
            if (__pyx_t_3 > 0)
            {
                __pyx_v_i = 0;
                #ifdef _OPENMP
                #pragma omp parallel
                #endif /* _OPENMP */
                {
                    #ifdef _OPENMP
                    #pragma omp for lastprivate(__pyx_v_j) firstprivate(__pyx_v_i) lastprivate(__pyx_v_i)
                    #endif /* _OPENMP */
                    for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_3; __pyx_t_2++){
                        {
                            __pyx_v_i = 0 + 1 * __pyx_t_2;
                            /* Initialize private variables to invalid values */
                            __pyx_v_j = ((int)0xbad0bad0);

      /* "kpm/mom.pyx":705
 *     cdef:
 *         int i, j
 *     for i in prange(rank, nogil=True):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):
 */
      /*finally:*/ {
        Py_BLOCK_THREADS
      }
  }

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line706")'> 706:         out[i] = 0</pre>
<pre id='line706' class='code' style='background-color: #FFFFff'>
                            /* "kpm/mom.pyx":706
 *         int i, j
 *     for i in prange(rank, nogil=True):
 *         out[i] = 0             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]
 */
                            (__pyx_v_out[__pyx_v_i]) = __pyx_t_double_complex_from_parts(0, 0);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line707")'> 707:         for j in range(ptr[i], ptr[i+1]):</pre>
<pre id='line707' class='code' style='background-color: #FFFFff'>
                            /* "kpm/mom.pyx":707
 *     for i in prange(rank, nogil=True):
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *             out[i] += dat[j]*vect[ind[j]]
 * 
 */
                            __pyx_t_4 = (__pyx_v_ptr[(__pyx_v_i + 1)]);
                            for (__pyx_t_5 = (__pyx_v_ptr[__pyx_v_i]); __pyx_t_5 <code><</code> __pyx_t_4; __pyx_t_5+=1) {
                              __pyx_v_j = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line708")'> 708:             out[i] += dat[j]*vect[ind[j]]</pre>
<pre id='line708' class='code' style='background-color: #FFFFff'>
                              /* "kpm/mom.pyx":708
 *         out[i] = 0
 *         for j in range(ptr[i], ptr[i+1]):
 *             out[i] += dat[j]*vect[ind[j]]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
                              __pyx_t_6 = __pyx_v_i;
                              (__pyx_v_out[__pyx_t_6]) = __Pyx_c_sum((__pyx_v_out[__pyx_t_6]), __Pyx_c_prod((__pyx_v_dat[__pyx_v_j]), (__pyx_v_vect[(__pyx_v_ind[__pyx_v_j])])));
                            }
                        }
                    }
                }
            }
        }
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line709")'> 709: </pre>
<pre id='line709' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line710")'> 710: </pre>
<pre id='line710' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line711")'> 711: @cython.cdivision(True)</pre>
<pre id='line711' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line712")'> 712: @cython.boundscheck(False)</pre>
<pre id='line712' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line713")'> 713: cdef inline void shift3_real(double **a, double **b, double **c):</pre>
<pre id='line713' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":713
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline void shift3_real(double **a, double **b, double **c):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """Permute the three given double pointers circular. Call with "&" (address
 *     of each pointer)."""
 */

static CYTHON_INLINE void __pyx_f_3kpm_3mom_shift3_real(double **__pyx_v_a, double **__pyx_v_b, double **__pyx_v_c) {
  double *__pyx_v_temp;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("shift3_real");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line714")'> 714:     """Permute the three given double pointers circular. Call with "&amp;" (address</pre>
<pre id='line714' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line715")'> 715:     of each pointer)."""</pre>
<pre id='line715' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line716")'> 716:     # former tb.kpm.core.shift3, developed from 2011-12-06 until 2011-12-11</pre>
<pre id='line716' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line717")'> 717:     cdef double *temp = a[0]</pre>
<pre id='line717' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":717
 *     of each pointer)."""
 *     # former tb.kpm.core.shift3, developed from 2011-12-06 until 2011-12-11
 *     cdef double *temp = a[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     a[0] = b[0]
 *     b[0] = c[0]
 */
  __pyx_v_temp = (__pyx_v_a[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line718")'> 718:     a[0] = b[0]</pre>
<pre id='line718' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":718
 *     # former tb.kpm.core.shift3, developed from 2011-12-06 until 2011-12-11
 *     cdef double *temp = a[0]
 *     a[0] = b[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     b[0] = c[0]
 *     c[0] = temp
 */
  (__pyx_v_a[0]) = (__pyx_v_b[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line719")'> 719:     b[0] = c[0]</pre>
<pre id='line719' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":719
 *     cdef double *temp = a[0]
 *     a[0] = b[0]
 *     b[0] = c[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     c[0] = temp
 * 
 */
  (__pyx_v_b[0]) = (__pyx_v_c[0]);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line720")'> 720:     c[0] = temp</pre>
<pre id='line720' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":720
 *     a[0] = b[0]
 *     b[0] = c[0]
 *     c[0] = temp             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  (__pyx_v_c[0]) = __pyx_v_temp;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line721")'> 721: </pre>
<pre id='line721' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line722")'> 722: </pre>
<pre id='line722' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line723")'> 723: @cython.cdivision(True)</pre>
<pre id='line723' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line724")'> 724: @cython.boundscheck(False)</pre>
<pre id='line724' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line725")'> 725: cdef inline void shift3_complex(complex **a, complex **b, complex **c):</pre>
<pre id='line725' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":725
 * @cython.cdivision(True)
 * @cython.boundscheck(False)
 * cdef inline void shift3_complex(complex **a, complex **b, complex **c):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 *     """Permute the three given complex pointers circular. Call with "&"
 */

static CYTHON_INLINE void __pyx_f_3kpm_3mom_shift3_complex(__pyx_t_double_complex **__pyx_v_a, __pyx_t_double_complex **__pyx_v_b, __pyx_t_double_complex **__pyx_v_c) {
  __pyx_t_double_complex *__pyx_v_temp;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("shift3_complex");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line726")'> 726: </pre>
<pre id='line726' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line727")'> 727:     """Permute the three given complex pointers circular. Call with "&amp;"</pre>
<pre id='line727' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line728")'> 728:     (address of each pointer).</pre>
<pre id='line728' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line729")'> 729: </pre>
<pre id='line729' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line730")'> 730:     """</pre>
<pre id='line730' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line731")'> 731:     # based on tb.kpm.core.shift3, developed from 2011-12-06 until 2011-12-11</pre>
<pre id='line731' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line732")'> 732:     cdef complex *temp = a[0]</pre>
<pre id='line732' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":732
 *     """
 *     # based on tb.kpm.core.shift3, developed from 2011-12-06 until 2011-12-11
 *     cdef complex *temp = a[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     a[0] = b[0]
 *     b[0] = c[0]
 */
  __pyx_v_temp = (__pyx_v_a[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line733")'> 733:     a[0] = b[0]</pre>
<pre id='line733' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":733
 *     # based on tb.kpm.core.shift3, developed from 2011-12-06 until 2011-12-11
 *     cdef complex *temp = a[0]
 *     a[0] = b[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     b[0] = c[0]
 *     c[0] = temp
 */
  (__pyx_v_a[0]) = (__pyx_v_b[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line734")'> 734:     b[0] = c[0]</pre>
<pre id='line734' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":734
 *     cdef complex *temp = a[0]
 *     a[0] = b[0]
 *     b[0] = c[0]             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     c[0] = temp
 * 
 */
  (__pyx_v_b[0]) = (__pyx_v_c[0]);
</pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line735")'> 735:     c[0] = temp</pre>
<pre id='line735' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":735
 *     a[0] = b[0]
 *     b[0] = c[0]
 *     c[0] = temp             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  (__pyx_v_c[0]) = __pyx_v_temp;

  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line736")'> 736: </pre>
<pre id='line736' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line737")'> 737: </pre>
<pre id='line737' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line738")'> 738: cdef print_array(double *arr, int length):</pre>
<pre id='line738' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":738
 * 
 * 
 * cdef print_array(double *arr, int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """Debugging utility to print a complete 1D C array to stdout."""
 *     __created__ = '2012-08-19'
 */

static PyObject *__pyx_f_3kpm_3mom_print_array(double *__pyx_v_arr, int __pyx_v_length) {
  PyObject *__pyx_v___created__ = NULL;
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("print_array");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line739")'> 739:     """Debugging utility to print a complete 1D C array to stdout."""</pre>
<pre id='line739' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line740")'> 740:     __created__ = '2012-08-19'</pre>
<pre id='line740' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":740
 * cdef print_array(double *arr, int length):
 *     """Debugging utility to print a complete 1D C array to stdout."""
 *     __created__ = '2012-08-19'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i
 *     for i in range(length):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_3));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line741")'> 741:     cdef int i</pre>
<pre id='line741' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line742")'> 742:     for i in range(length):</pre>
<pre id='line742' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":742
 *     __created__ = '2012-08-19'
 *     cdef int i
 *     for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         print arr[i],
 *     print
 */
  __pyx_t_1 = __pyx_v_length;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line743")'> 743:         print arr[i],</pre>
<pre id='line743' class='code' style='background-color: #FFFF6a'>
    /* "kpm/mom.pyx":743
 *     cdef int i
 *     for i in range(length):
 *         print arr[i],             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     print
 * 
 */
    __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_arr[__pyx_v_i]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 0) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 743; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  }
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line744")'> 744:     print</pre>
<pre id='line744' class='code' style='background-color: #FFFF86'>
  /* "kpm/mom.pyx":744
 *     for i in range(length):
 *         print arr[i],
 *     print             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 * 
 * 
 */
  if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_empty_tuple), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 744; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom.print_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line745")'> 745: </pre>
<pre id='line745' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line746")'> 746: </pre>
<pre id='line746' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line747")'> 747: cdef print_array_int(int *arr, int length):</pre>
<pre id='line747' class='code' style='background-color: #FFFFff'>
/* "kpm/mom.pyx":747
 * 
 * 
 * cdef print_array_int(int *arr, int length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     """Debugging utility to print a complete 1D C array to stdout."""
 *     __created__ = '2012-09-05'
 */

static PyObject *__pyx_f_3kpm_3mom_print_array_int(int *__pyx_v_arr, int __pyx_v_length) {
  PyObject *__pyx_v___created__ = NULL;
  int __pyx_v_i;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannySetupContext</span></span>("print_array_int");
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line748")'> 748:     """Debugging utility to print a complete 1D C array to stdout."""</pre>
<pre id='line748' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFe7' onclick='toggleDiv("line749")'> 749:     __created__ = '2012-09-05'</pre>
<pre id='line749' class='code' style='background-color: #FFFFe7'>
  /* "kpm/mom.pyx":749
 * cdef print_array_int(int *arr, int length):
 *     """Debugging utility to print a complete 1D C array to stdout."""
 *     __created__ = '2012-09-05'             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     cdef int i
 *     for i in range(length):
 */
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_kp_s_17));
  __pyx_v___created__ = ((PyObject *)__pyx_kp_s_17);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line750")'> 750:     cdef int i</pre>
<pre id='line750' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line751")'> 751:     for i in range(length):</pre>
<pre id='line751' class='code' style='background-color: #FFFFff'>
  /* "kpm/mom.pyx":751
 *     __created__ = '2012-09-05'
 *     cdef int i
 *     for i in range(length):             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *         print arr[i],
 *     print
 */
  __pyx_t_1 = __pyx_v_length;
  for (__pyx_t_2 = 0; __pyx_t_2 <code><</code> __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFF6a' onclick='toggleDiv("line752")'> 752:         print arr[i],</pre>
<pre id='line752' class='code' style='background-color: #FFFF6a'>
    /* "kpm/mom.pyx":752
 *     cdef int i
 *     for i in range(length):
 *         print arr[i],             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 *     print
 */
    __pyx_t_3 = <span class='py_c_api'>PyInt_FromLong</span>((__pyx_v_arr[__pyx_v_i]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GOTREF</span></span>(((PyObject *)__pyx_t_4));
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_3);
    <span class='pyx_macro_api'><span class='refnanny'>__Pyx_GIVEREF</span></span>(__pyx_t_3);
    __pyx_t_3 = 0;
    if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_t_4), 0) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 752; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_t_4)); __pyx_t_4 = 0;
  }
</pre><pre class='line' style='background-color: #FFFF86' onclick='toggleDiv("line753")'> 753:     print</pre>
<pre id='line753' class='code' style='background-color: #FFFF86'>
  /* "kpm/mom.pyx":753
 *     for i in range(length):
 *         print arr[i],
 *     print             # <code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code><code><</code>
 */
  if (<span class='pyx_c_api'>__Pyx_Print</span>(0, ((PyObject *)__pyx_empty_tuple), 1) <code><</code> 0)<span class='error_goto'> {__pyx_filename = __pyx_f[0]; __pyx_lineno = 753; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>

  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("kpm.mom.print_array_int", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v___created__);
  <span class='pyx_macro_api'><span class='refnanny'>__Pyx_XGIVEREF</span></span>(__pyx_r);
  <span class='pyx_c_api'><span class='refnanny'>__Pyx_RefNannyFinishContext</span></span>();
  return __pyx_r;
}
</pre></body></html>
